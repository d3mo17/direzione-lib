/**
 * Direzione Library v1.1.0
 *
 * A library of components that can be used to manage a martial arts tournament
 *
 * Copyright (C) 2023 Daniel Moritz
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, in version 3 of the License.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>
 */!function(t,e){if("function"==typeof define&&define.amd)define("direzione-lib/model/FightHistory",e);else if("object"==typeof module&&module.exports)module.exports=e();else{t.Direzione=t.Direzione||{};t.Direzione.FightHistory=e()}}(this,function(){function e(t){this[" fight"]=t;this[" log"]=[];this.registerEventListeners()}(e.prototype={getFight:function(){return this[" fight"]},getLog:function(){return JSON.parse(JSON.stringify(this[" log"]))}}).insert=function(t,e){var i,n=t;if("removeCountUp"!==t){for(;"startPauseResume"===t;){if(0===this[" log"].length){n="start";break}n=(i=this[" fight"].getCountdown())&&i.isPaused()?"pause":"resume";break}this[" log"].push([Date.now()].concat(n,e))}};e.prototype.registerEventListeners=function(){this[" fight"].getWhiteOpponent().on("add",t.bind(this,"white","add")).on("remove",t.bind(this,"white","remove"));this[" fight"].getRedOpponent().on("add",t.bind(this,"red/blue","add")).on("remove",t.bind(this,"red/blue","remove"))};function t(t,e,i){this[" log"].push([Date.now(),t,e,i])}return{create:function(t){return new e(t)}}});!function(t,e){if("function"==typeof define&&define.amd)define("direzione-lib/model/Fight",["durata/dist/durata.min","direzione-lib/model/FightHistory"],e);else if("object"==typeof module&&module.exports)module.exports=e(require("durata"),require("./FightHistory"));else{t.Direzione=t.Direzione||{};t.Direzione.Fight=e(t.Durata,t.Direzione.FightHistory)}}(this,function(s,o){function r(t,e,i,n){this[" settings"]=t;this[" whiteOpponent"]=e;this[" redOpponent"]=i;this[" history"]=(void 0===n||!n)&&o.create(this);this[" stopped"]=!1;this[" listener"]={reset:[],startPauseResume:[],osaeKomi:[],stop:[],toketa:[],removeCountUp:[],timeUp:[]}}r.DURATION=18e4;r.COUNTUP=1e4;r.LOCK_OUT=6e5;r.SIDE_WHITE="white";r.SIDE_RED="red";r.SIDE_CENTER="center";r.prototype={clearListeners:function(t){t=void 0===t||t;Object.keys(this[" listener"]).forEach(function(t){delete this[" listener"][t];this[" listener"][t]=[]},this);this.getRedOpponent().clearListeners();this.getWhiteOpponent().clearListeners();t&&this.getHistory()&&this.getHistory().registerEventListeners()},getHistory:function(){return this[" history"]},getCountdown:function(){return i.call(this)&&this[" countdown"]},getCountUp:function(){return h.call(this)&&this[" countup"]},getWhiteOpponent:function(){return this[" whiteOpponent"]},getRedOpponent:function(){return this[" redOpponent"]},getTimeLeft:function(){return i.call(this)?this[" countdown"].get():this[" settings"].getDuration()},isRunning:function(){return!this[" stopped"]&&i.call(this)&&!this[" countdown"].isPaused()&&!this[" countdown"].isComplete()},isStopped:function(){return this[" stopped"]},invertSide:c,on:function(t,e){var i=Object.keys(this[" listener"]);if(-1===i.indexOf(t))throw new RangeError("Only following values are allowed for event type: "+i.join(", ")+"!");this[" listener"][t].push(e);return this},removeCountUp:n,reset:function(t){this[" stopped"]=!1;n.call(this);i.call(this)&&this[" countdown"].stop("interrupt");u.call(this,t);this[" countdown"].pause("reset");this[" whiteOpponent"].reset();this[" redOpponent"].reset();void 0===t&&d.call(this,"reset",i.call(this)?this[" countdown"].get():void 0)},startPauseResume:function(t){if(!this.isStopped()){if(i.call(this)){if(this[" countdown"].isComplete())return;if(void 0!==t){var e=this[" countdown"].isPaused();u.call(this,t);e&&this[" countdown"].pause("renew")}!function(){this.isStopped()||this[" countdown"].isPaused()&&this[" countdown"].resume("toggle")||this[" countdown"].pause("toggle")}.call(this)}else u.call(this,t);void 0===t&&d.call(this,"startPauseResume",this[" countdown"].get())}},osaeKomi:function(t,e){if(void 0!==e||!this.isStopped()&&i.call(this)&&!this[" countdown"].isPaused()){t=t||r.SIDE_CENTER;t=this[" settings"].isGripSideInverted()?c(t):t;!h.call(this)||this[" countup"].isPaused()||void 0!==e?l.call(this,t,e):this[" countup"].side=t;void 0===e&&d.call(this,"osaeKomi",this[" settings"].isGripSideInverted()?c(t):t)}},stop:function(t,e,i){if(!this[" stopped"]){this[" stopped"]=!0;if(void 0===t)this[" countdown"].stop("timeup");else{u.call(this,t);this[" countdown"].stop("timeup");l.call(this,i,e)}h.call(this)&&this[" countup"].stop("timeup");if(void 0===t){this[" whiteOpponent"].getPerson().setLockOut(this[" settings"].getLockOutTime());this[" redOpponent"].getPerson().setLockOut(this[" settings"].getLockOutTime());d.call(this,"stop",[this[" countdown"].get(),h.call(this)?this[" countup"].get():0,h.call(this)?this[" countup"].side:r.SIDE_CENTER])}}},toketa:a};function i(){return void 0!==this[" countdown"]}function h(){return void 0!==this[" countup"]}function n(){if(h.call(this)){this[" countup"].stop("reset");delete this[" countup"];d.call(this,"removeCountUp")}}function u(t){var e=void 0!==t?t:this[" settings"].getDuration();i.call(this)&&this[" countdown"].stop("dirty");this[" countdown"]=s.create(e,0,e).on("resume",n.bind(this)).on("pause",function(t){"osaekomi-timeup"===t&&d.call(this,"timeUp")}.bind(this));void 0===t&&this[" countdown"].on("complete",d.bind(this,"timeUp")).on("pause",a.bind(this,void 0))}function c(t){return t===r.SIDE_CENTER?r.SIDE_CENTER:t===r.SIDE_RED?r.SIDE_WHITE:r.SIDE_RED}function l(t,e){var i=e||0,n=this[" settings"].getCountUpLimit(),o=void 0!==e?this[" settings"].getCountUpLimitIppon():n;h.call(this)&&this[" countup"].stop("dirty");this[" countup"]=s.create(i,o,o-i);this[" countup"].side=t;void 0===e&&this[" countup"].on("pause",function(){d.call(this,"toketa",this[" countup"].get())}.bind(this)).on("complete",function(){if(0!==this[" "+this[" countup"].side+"Opponent"].getScore())this[" countdown"].isPaused()||this[" countdown"].pause("osaekomi-timeup");else{this[" countup"].stop("replace");l.call(this,this[" countup"].side,n);this[" countup"].on("pause",function(){d.call(this,"toketa",this[" countup"].get())}.bind(this)).on("complete",function(){this[" countdown"].isPaused()||this[" countdown"].pause("osaekomi-timeup")}.bind(this))}}.bind(this))}function a(t){void 0!==t&&l.call(this,this[" countup"].side,t);h.call(this)&&this[" countup"].pause("toketa")}function d(t,e){this[" history"]&&this[" history"].insert(t,e);this[" listener"][t].forEach(function(t){t.call(this,e)},this)}return{create:function(t,e,i,n){return new r(t,e,i,n)},DURATION:r.DURATION,COUNTUP:r.COUNTUP,LOCK_OUT:r.LOCK_OUT,SIDE_WHITE:r.SIDE_WHITE,SIDE_RED:r.SIDE_RED,SIDE_CENTER:r.SIDE_CENTER}});!function(t,e){if("function"==typeof define&&define.amd)define("direzione-lib/config/FightSettings",["direzione-lib/model/Fight"],e);else if("object"==typeof module&&module.exports)module.exports=e(require("../model/Fight"));else{t.Direzione=t.Direzione||{};t.Direzione.FightSettings=e(t.Direzione.Fight)}}(this,function(t){var e=["duration","countUpLimit","countUpLimitIppon","personLockOut","timeUpSoundFile"];function i(){this.duration=t.DURATION;this.countUpLimit=t.COUNTUP;this.countUpLimitIppon=2*t.COUNTUP;this.personLockOut=t.LOCK_OUT;this.invertGripDisplay=!1;this.invertGripSide=!1;this.timeUpSoundFile="";this.fromStorage();this.fromURLParameters()}i.prototype={toStorage:function(){localStorage.setItem("Direzione.FightSettings",JSON.stringify(this))},fromStorage:function(){var e,t=localStorage.getItem("Direzione.FightSettings");if(t){e=JSON.parse(t);Object.keys(e).forEach(function(t){this[t]=e[t]},this)}},fromURLParameters:function(){var t=new URLSearchParams(window.location.search);Array.from(t.entries()).forEach(function(t){e.includes(t[0])&&(this[t[0]]=t[1])},this)},getDuration:function(){return this.duration},getCountUpLimit:function(){return this.countUpLimit},getCountUpLimitIppon:function(){return this.countUpLimitIppon},getLockOutTime:function(){return this.personLockOut},isGripDisplayInverted:function(){return this.invertGripDisplay},isGripSideInverted:function(){return this.invertGripSide},getTimeUpSoundFile:function(){return this.timeUpSoundFile},setDuration:function(t){if(!Number.isInteger(t))throw TypeError("Duration has to be of type integer");this.duration=t;return this},setCountUpLimit:function(t){if(!Number.isInteger(t))throw TypeError("Limit for count up (wazari) has to be of type integer");this.countUpLimit=t;return this},setCountUpLimitIppon:function(t){if(!Number.isInteger(t))throw TypeError("Limit for count up (ippon) has to be of type integer");this.countUpLimitIppon=t;return this},setLockOutTime:function(t){if(!Number.isInteger(t))throw TypeError("The lock-out time has to be of type integer");this.personLockOut=t;return this},setGripDisplayInverted:function(t){this.invertGripDisplay=!!t;return this},setGripSideInverted:function(t){this.invertGripSide=!!t;return this},setTimeUpSoundFile:function(t){this.timeUpSoundFile=t;return this}};return{create:function(){return new i}}});!function(t,e){if("function"==typeof define&&define.amd)define("direzione-lib/model/Opponent",e);else if("object"==typeof module&&module.exports)module.exports=e();else{t.Direzione=t.Direzione||{};t.Direzione.Opponent=e()}}(this,function(){function n(t,e,i){this[" person"]=t;this[" score"]=e||0;this[" penalty"]=i||0;this[" listener"]={add:[],remove:[],reset:[]}}n.SCORE_WAZARI=4;n.MAX_SCORE=n.SCORE_IPPON=8;n.MAX_PENALTY=3*(n.PENALTY_SHIDO=1);n.prototype={clearListeners:function(){Object.keys(this[" listener"]).forEach(function(t){delete this[" listener"][t];this[" listener"][t]=[]},this)},addIppon:function(){if(!(this[" score"]>=n.MAX_SCORE)){t.call(this,"add","Ippon");this[" score"]=n.SCORE_IPPON}},addShido:function(){if(!(this[" penalty"]>=n.MAX_PENALTY)){t.call(this,"add","Shido");this[" penalty"]=this[" penalty"]+n.PENALTY_SHIDO}},addWazari:function(){if(!(this[" score"]>=n.MAX_SCORE)){t.call(this,"add","Wazari");this[" score"]=this[" score"]+n.SCORE_WAZARI}},getPerson:function(){return this[" person"]},getFullName:function(){return this.getPerson().getFirstName()+" "+this.getPerson().getLastName()},getScore:function(){return this[" score"]>=n.MAX_SCORE?n.MAX_SCORE:this[" score"]},getShido:function(){return this[" penalty"]>=n.MAX_PENALTY?n.MAX_PENALTY:this[" penalty"]},on:function(t,e){var i=Object.keys(this[" listener"]);if(-1===i.indexOf(t))throw new RangeError("Only following values are allowed for event type: "+i.join(", ")+"!");this[" listener"][t].push(e);return this},removeIppon:function(){if(!(this[" score"]-n.SCORE_IPPON<0)){t.call(this,"remove","Ippon");this[" score"]=this[" score"]-n.SCORE_IPPON}},removeShido:function(){if(!(this[" penalty"]<=0)){t.call(this,"remove","Shido");this[" penalty"]=this[" penalty"]-n.PENALTY_SHIDO}},removeWazari:function(){if(!(this[" score"]<=0)){t.call(this,"remove","Wazari");this[" score"]=this[" score"]-n.SCORE_WAZARI}},reset:function(){t.call(this,"reset");this[" score"]=0;this[" penalty"]=0;this.getPerson().reset()}};function t(t,e){this[" listener"][t].forEach(function(t){t.call(this,e)},this)}return{create:function(t,e,i){return new n(t,e,i)}}});!function(t,e){if("function"==typeof define&&define.amd)define("direzione-lib/model/Person",["durata/dist/durata.min"],e);else if("object"==typeof module&&module.exports)module.exports=e(require("durata"));else{t.Direzione=t.Direzione||{};t.Direzione.Person=e(t.Durata)}}(this,function(e){function n(t,e,i){this[" firstName"]=t;this[" lastName"]=e;this[" club"]=i}n.prototype={getClubName:function(){return this[" club"]},getFirstName:function(){return this[" firstName"]},getLastName:function(){return this[" lastName"]},setLockOut:function(t){this.reset();this[" lockout"]=e.create(t,0,t)},getLockOut:function(){return void 0!==this[" lockout"]&&this[" lockout"]},reset:function(){void 0!==this[" lockout"]&&this[" lockout"].stop();delete this[" lockout"]},toStruct:function(){return{firstName:this[" firstName"],lastName:this[" lastName"],club:this[" club"]}}};return{create:function(t,e,i){return new n(t,e,i)},isInstance:function(t){return t instanceof n}}});!function(t,e){if("function"==typeof define&&define.amd)define("direzione-lib/model/OpponentGroup",["direzione-lib/model/Person"],e);else if("object"==typeof module&&module.exports)module.exports=e(require("./Person"));else{t.Direzione=t.Direzione||{};t.Direzione.OpponentGroup=e(t.Direzione.Person)}}(this,function(e){function i(t){this[" name"]=t;this[" persons"]=[];this[" listener"]={add:[],remove:[]}}i.prototype={addPerson:function(t){if(e.isInstance(t)){n.call(this,"add",t);this[" persons"].push(t)}},removePerson:function(e){var t=this[" persons"].length;this[" persons"]=this[" persons"].filter(function(t){return t!==e});t!==this[" persons"].length&&n.call(this,"remove",e)},getPersons:function(){return this[" persons"].slice()},on:function(t,e){var i=Object.keys(this[" listener"]);if(-1===i.indexOf(t))throw new RangeError("Only following values are allowed for event type: "+i.join(", ")+"!");this[" listener"][t].push(e);return this},getName:function(){return this[" name"]},toStruct:function(){return{name:this[" name"],persons:this[" persons"].map(function(t){return t.toStruct()})}}};function n(t,e){this[" listener"][t].forEach(function(t){t.call(this,e)},this)}return{create:function(t){return new i(t)}}});!function(t,e){if("function"==typeof define&&define.amd)define("direzione-lib/model/Playlist",e);else if("object"==typeof module&&module.exports)module.exports=e();else{t.Direzione=t.Direzione||{};t.Direzione.Playlist=e()}}(this,function(){function t(){this[" cursor"]=void 0;this[" head"]=void 0;this[" tail"]=void 0;this[" length"]=0;this[" eof"]=!1}t.prototype={empty:function(){var t;r.call(this);for(;t=s.call(this);)o.call(this,t);return r.call(this)},find:i,insert:function(t){t=new e(this,t);if(this[" length"])if(void 0===this[" cursor"]){(this[" head"][" prev"]=t)[" next"]=this[" head"];this[" head"]=t}else{void 0===this[" cursor"][" next"]?this[" tail"]=t:this[" cursor"][" next"][" prev"]=t;t[" next"]=this[" cursor"][" next"];(this[" cursor"][" next"]=t)[" prev"]=this[" cursor"];this[" cursor"]=t}else{this[" head"]=t;this[" tail"]=t;this[" cursor"]=t}this[" length"]++;this[" eof"]=!1;return this[" length"]},includes:n,next:s,prev:function(){var t;if(this[" eof"]){this[" eof"]=!1;t=this[" cursor"]=this[" tail"]}else{t=this[" cursor"]&&this[" cursor"][" prev"];this[" cursor"]=t}return t&&t[" value"]},reset:r,remove:o,getLength:function(){return this[" length"]}};function e(t,e){this[" list"]=t;this[" value"]=e;this[" prev"]=void 0;this[" next"]=void 0}function i(t,e){if("function"!=typeof t)throw new TypeError("You must provide a function as first argument");if(this[" length"]){(e=e||0)<0&&(e=this[" length"]+e);for(var i=this[" head"],n=0;n<this[" length"];n++){if(e<=n&&t(i[" value"],n)){this[" cursor"]=i;this[" eof"]=!1;return i[" value"]}i=i[" next"]}this[" cursor"]=void 0}}function n(e,t){i.call(this,function(t){return Object.is(t,e)},t);return!!this[" cursor"]}function o(t,e){if(n.call(this,t,e)){t=this[" cursor"];!function(){if(this[" list"]){this[" prev"]&&(this[" prev"][" next"]=this[" next"]);this[" next"]&&(this[" next"][" prev"]=this[" prev"]);this===this[" list"][" cursor"]&&(this[" list"][" cursor"]=this[" next"]||this[" prev"]);this===this[" list"][" head"]&&(this[" list"][" head"]=this[" next"]);this===this[" list"][" tail"]&&(this[" list"][" tail"]=this[" prev"]);this[" list"][" length"]--;this[" prev"]=void 0;this[" next"]=void 0;this[" list"]=void 0}}.call(t);r.call(this);return t[" value"]}}function s(){var t;if(this[" cursor"]!==this[" tail"])return t=this[" cursor"]?this[" cursor"][" next"]:this[" head"],(this[" cursor"]=t)&&t[" value"];this[" eof"]=!0}function r(){this[" cursor"]=void 0;this[" eof"]=!1;return this}return{create:function(){return new t}}});!function(t,e){if("function"==typeof define&&define.amd)define("direzione-lib/util/Utils",e);else if("object"==typeof module&&module.exports)module.exports=e();else{t.Direzione=t.Direzione||{};t.Direzione.Utils=e()}}(this,function(){return{loadTranslationJS:function(t,e,i){var n=document.createElement("script");n.onload=function(){e(Direzione.translation)};n.async=!!i;n.src=t;document.head.appendChild(n)},getMinSecDisplay:function(t){t=Math.ceil(t/1e3);return Math.floor(t/60)+":"+(t%60+"").padStart(2,"0")}}});!function(t,e){if("function"==typeof define&&define.amd)define("direzione-lib/view/Scoreboard",["direzione-lib/model/Fight","direzione-lib/util/Utils"],e);else if("object"==typeof module&&module.exports)module.exports=e(require("../model/Fight"),require("../util/Utils"));else{t.Direzione=t.Direzione||{};t.Direzione.Scoreboard=e(t.Direzione.Fight,t.Direzione.Utils)}}(this,function(i,n){function o(t,e){this[" fight"]=t;this[" outputElems"]={countdown:e.outputElemCountdown,clockSec:e.outputElemStopwatchSeconds,clockMSec:e.outputElemStopwatchMilliseconds,whiteScore:e.outputElemWhiteScore,redScore:e.outputElemRedScore,whiteShido:e.outputElemWhiteShido,redShido:e.outputElemRedShido,whiteOpponent:e.outputElemWhiteOpponent,redOpponent:e.outputElemRedOpponent,whiteClub:e.outputElemWhiteClub,redClub:e.outputElemRedClub};this[" initValMemCountdown"]=e.outputElemCountdown.innerText;this.showNames();this.run()}o.prototype={replaceFight:function(t){this.stop();this[" fight"]=t;this.showNames();this.run()},run:function(){this[" allowRun"]=!0;requestAnimationFrame(this[" animationLoop"]=function(){!function(){this[" outputElems"].countdown.innerText=n.getMinSecDisplay(this[" fight"].getTimeLeft());var t=this[" fight"].getCountUp();if(t){var e=t.get();this[" outputElems"].clockSec.innerText=r(e);this[" outputElems"].clockMSec.innerText=s(e);this[" outputElems"].clockSec.parentNode.className=this[" fight"][" settings"].isGripDisplayInverted()?this[" fight"].invertSide(t.side):t.side}else{this[" outputElems"].clockSec.innerText=r(0);this[" outputElems"].clockMSec.innerText=s(0);this[" outputElems"].clockSec.parentNode.className=i.SIDE_CENTER}this[" outputElems"].whiteScore.innerText=this[" fight"].getWhiteOpponent().getScore();this[" outputElems"].redScore.innerText=this[" fight"].getRedOpponent().getScore();this[" outputElems"].whiteShido.innerText=this[" fight"].getWhiteOpponent().getShido();this[" outputElems"].redShido.innerText=this[" fight"].getRedOpponent().getShido()}.call(this);this[" allowRun"]?requestAnimationFrame(this[" animationLoop"]):this[" allowRun"]=!0}.bind(this))},stop:function(){this[" allowRun"]=!1},showNames:function(){this[" outputElems"].whiteOpponent.innerText=this[" fight"].getWhiteOpponent().getFullName();this[" outputElems"].redOpponent.innerText=this[" fight"].getRedOpponent().getFullName();this[" outputElems"].whiteClub.innerText=this[" fight"].getWhiteOpponent().getPerson().getClubName();this[" outputElems"].redClub.innerText=this[" fight"].getRedOpponent().getPerson().getClubName()},hideNames:function(){this[" outputElems"].whiteOpponent.innerText="";this[" outputElems"].redOpponent.innerText="";this[" outputElems"].whiteClub.innerText="";this[" outputElems"].redClub.innerText=""},shutdown:function(){this.stop();this.hideNames();requestAnimationFrame(function(){this[" outputElems"].countdown.innerText=this[" initValMemCountdown"];this[" outputElems"].clockSec.innerText=r(0);this[" outputElems"].clockMSec.innerText=s(0);this[" outputElems"].clockSec.parentNode.className=i.SIDE_CENTER;this[" outputElems"].whiteScore.innerText=0;this[" outputElems"].redScore.innerText=0;this[" outputElems"].whiteShido.innerText=0;this[" outputElems"].redShido.innerText=0}.bind(this))}};function s(t){return(Math.floor(t%1e3)+"").padStart(3,"0")}function r(t){return Math.floor(t/1e3)%60}return{create:function(t,e){return new o(t,e)}}});!function(t,e){if("function"==typeof define&&define.amd)define("direzione-lib/service/FightEmitter",["peerjs/dist/peerjs.min"],e);else if("object"==typeof module&&module.exports)module.exports=e(require("peerjs"));else{t.Direzione=t.Direzione||{};t.Direzione.FightEmitter=e(t.peerjs)}}(this,function(n){function i(t,e,i){i=(i=i||[]).length<1?{}:{config:{iceServers:i}};this[" localPeer"]=new n.Peer(i);this[" fight"]=e;this[" receiverID"]=t;this[" connected"]=!1;this[" conn"]=!1;this[" listener"]={disconnect:[],establish:[]};s.call(this)}i.prototype={connect:function(){var i={resolve:null,reject:null};i.promise=new Promise(function(t,e){i.resolve=t;i.reject=e});this[" conn"]=this[" localPeer"].connect(this[" receiverID"]);this[" conn"].on("open",function(){this[" connected"]=!0;!function(){var t;function e(t,e){return["new",t,e.getPerson().getFirstName(),e.getPerson().getLastName(),e.getPerson().getClubName(),e.getScore(),e.getShido()]}o.call(this,e("white",this[" fight"].getWhiteOpponent()));o.call(this,e("red",this[" fight"].getRedOpponent()));o.call(this,["new","fight",this[" fight"].getTimeLeft(),this[" fight"][" settings"].getCountUpLimit(),this[" fight"][" settings"].getCountUpLimitIppon(),this[" fight"][" settings"].isGripDisplayInverted(),this[" fight"][" settings"].isGripSideInverted()]);this[" fight"].isRunning()&&o.call(this,["fight","startPauseResume",this[" fight"].getTimeLeft()]);if(t=this[" fight"].getCountUp()){var i=t.isComplete()?4:t.isStopped()?3:t.isPaused()?2:1,n=this[" fight"][" settings"].isGripSideInverted()?this[" fight"].invertSide(t.side):t.side;o.call(this,["new","countup",n,t.get(),i])}}.call(this);t.call(this,"establish","peer opened");i.resolve()}.bind(this));this[" conn"].on("close",function(){this[" connected"]=!1;t.call(this,"disconnect","peer closed")}.bind(this));return i.promise},disconnect:function(){return this[" connected"]&&this[" conn"].close()||!0},isConnected:function(){return this[" connected"]},on:function(t,e){var i=Object.keys(this[" listener"]);if(-1===i.indexOf(t))throw new RangeError("Only following values are allowed for event type: "+i.join(", ")+"!");this[" listener"][t].push(e);return this},getFight:function(){return this[" fight"]},replaceFight:function(t){this.disconnect();this[" fight"].clearListeners();delete this[" fight"];this[" fight"]=t;s.call(this)}};function o(t){this.isConnected()&&this[" conn"].send(t)}function s(){var t=this[" fight"].getRedOpponent(),e=this[" fight"].getWhiteOpponent();this[" fight"].on("reset",function(t){o.call(this,["fight","reset",t])}.bind(this));this[" fight"].on("startPauseResume",function(t){o.call(this,["fight","startPauseResume",t])}.bind(this));this[" fight"].on("stop",function(t){o.call(this,["fight","stop",t[0],t[1],t[2]])}.bind(this));this[" fight"].on("toketa",function(t){o.call(this,["fight","toketa",t])}.bind(this));this[" fight"].on("osaeKomi",function(t){o.call(this,["fight","osaeKomi",t])}.bind(this));this[" fight"].on("removeCountUp",function(){o.call(this,["fight","removeCountUp"])}.bind(this));t.on("add",function(t){o.call(this,["red","add"+t])}.bind(this)).on("remove",function(t){o.call(this,["red","remove"+t])}.bind(this));e.on("add",function(t){o.call(this,["white","add"+t])}.bind(this)).on("remove",function(t){o.call(this,["white","remove"+t])}.bind(this))}function t(t,e){this[" listener"][t].forEach(function(t){t.call(this,e)},this)}return{create:function(t,e){return new i(t,e)}}});!function(t,e){if("function"==typeof define&&define.amd)define("direzione-lib/service/FightReceiver",["peerjs/dist/peerjs.min","direzione-lib/model/Fight","direzione-lib/config/FightSettings","direzione-lib/model/Opponent","direzione-lib/model/Person","direzione-lib/view/Scoreboard"],e);else if("object"==typeof module&&module.exports)module.exports=e(require("peerjs"),require("../model/Fight"),require("../config/FightSettings"),require("../model/Opponent"),require("../model/Person"),require("../view/Scoreboard"));else{t.Direzione=t.Direzione||{};t.Direzione.FightReceiver=e(t.peerjs,t.Direzione.Fight,t.Direzione.FightSettings,t.Direzione.Opponent,t.Direzione.Person,t.Direzione.Scoreboard)}}(this,function(n,o,s,r,h,u){function i(t,e,i){i=(i=i||[]).length<1?{}:{config:{iceServers:i}};this[" localPeer"]=new n.Peer(t,i);this[" receiverID"]=t;this[" connected"]=!1;this[" conn"]=!1;this[" viewConfig"]=e;this[" listener"]={disconnect:[],establish:[]};this[" redOpponent"]=null;this[" whiteOpponent"]=null;this[" fight"]=null;this[" board"]=null;this[" initValMemCountdown"]=e.outputElemCountdown.innerText;!function(){this[" localPeer"].on("connection",function(t){(this[" conn"]=t).on("open",function(){this[" connected"]=!0;c.call(this,"establish","peer opened");t.on("data",function(t){if("new"===t[0])switch(t[1]){case"red":return this[" redOpponent"]=r.create(h.create(t[2],t[3],t[4]),t[5],t[6]);case"white":return this[" whiteOpponent"]=r.create(h.create(t[2],t[3],t[4]),t[5],t[6]);case"fight":var e=s.create();e.setDuration(t[2]).setCountUpLimit(t[3]).setCountUpLimitIppon(t[4]).setGripDisplayInverted(t[5]).setGripSideInverted(t[6]);this[" viewConfig"].outputElemCountdown.innerText=this[" initValMemCountdown"];this[" fight"]=o.create(e,this[" whiteOpponent"],this[" redOpponent"],!0);this[" board"]=u.create(this[" fight"],this[" viewConfig"]);return;case"countup":this[" fight"].osaeKomi(t[2],t[3]);return-1!==[4,3,2].indexOf(t[4])?this[" fight"].toketa(t[3]):void 0}switch(t[0]){case"fight":return this[" fight"][t[1]](3<=t.length?t[2]:void 0,4<=t.length?t[3]:void 0,5<=t.length?t[4]:void 0);case"red":return this[" redOpponent"][t[1]]();case"white":return this[" whiteOpponent"][t[1]]()}}.bind(this))}.bind(this));t.on("close",function(){this[" connected"]=!1;this[" board"].shutdown();c.call(this,"disconnect","peer closed")}.bind(this))}.bind(this))}.call(this)}i.prototype={isConnected:function(){return this[" connected"]},on:function(t,e){var i=Object.keys(this[" listener"]);if(-1===i.indexOf(t))throw new RangeError("Only following values are allowed for event type: "+i.join(", ")+"!");this[" listener"][t].push(e);return this}};function c(t,e){this[" listener"][t].forEach(function(t){t.call(this,e)},this)}return{create:function(t,e){return new i(t,e)}}});!function(t,e){if("function"==typeof define&&define.amd)define("direzione-lib/service/LocalBroker",e);else if("object"==typeof module&&module.exports)module.exports=e();else{t.Direzione=t.Direzione||{};t.Direzione.LocalBroker=e()}}(this,function(){function e(t){this[" localPeer"]=t;localStorage.a=localStorage.b=JSON.stringify([]);this[" idx"]=0;this[" intv"]=setInterval(function(){if(!this[" in"]){if(!JSON.parse(localStorage.a).length)return;this[" in"]="a";this[" out"]="b"}var t=JSON.parse(localStorage[this[" in"]]);if(!(t.length<=this[" idx"])){this.onmessage&&this.onmessage({data:t[this[" idx"]]});this[" idx"]++}}.bind(this),20);setTimeout(function(){this.onopen&&this.onopen({})}.bind(this))}e.prototype={send:function(t){if(!this[" out"]){this[" out"]="a";this[" in"]="b"}var e=JSON.parse(localStorage[this[" out"]]);e.push(t);localStorage[this[" out"]]=JSON.stringify(e)},onmessage:function(t){t=t.data;t.sdp&&this[" localPeer"].setRemoteDescription(new RTCSessionDescription(t.sdp)).then(function(){"stable"!=this[" localPeer"].signalingState&&this[" localPeer"].createAnswer().then(function(t){return this[" localPeer"].setLocalDescription(t)}.bind(this)).then(function(){this.send({sdp:this[" localPeer"].localDescription})}.bind(this))}.bind(this))||t.candidate&&this[" localPeer"].addIceCandidate(new RTCIceCandidate(t.candidate))},close:function(){clearInterval(this[" intv"]);localStorage.a=localStorage.b=JSON.stringify([])}};return{create:function(t){return new e(t)}}});!function(t,e){if("function"==typeof define&&define.amd)define("direzione-lib/service/FightEmitterLocal",["direzione-lib/service/LocalBroker"],e);else if("object"==typeof module&&module.exports)module.exports=e(require("./LocalBroker"));else{t.Direzione=t.Direzione||{};t.Direzione.FightEmitterLocal=e(t.Direzione.LocalBroker)}}(this,function(i){function n(t,e){this[" localPeer"]=new RTCPeerConnection;this[" fight"]=e;this[" receiverID"]=t;this[" connected"]=!1;this[" conn"]=!1;this[" listener"]={disconnect:[],establish:[]};!function(){var e=i.create(this[" localPeer"]);this[" broker"]=e;this[" localPeer"].onicecandidate=function(t){e.send({candidate:t.candidate})};this[" localPeer"].onnegotiationneeded=function(){this[" localPeer"].createOffer().then(function(t){return this[" localPeer"].setLocalDescription(t)}.bind(this)).then(function(){e.send({sdp:this[" localPeer"].localDescription})}.bind(this))}.bind(this)}.call(this);s.call(this)}n.prototype={connect:function(){var i={resolve:null,reject:null};i.promise=new Promise(function(t,e){i.resolve=t;i.reject=e});this[" conn"]=this[" localPeer"].createDataChannel(this[" receiverID"]);this[" conn"].onopen=function(){this[" connected"]=!0;!function(){var t;function e(t,e){return["new",t,e.getPerson().getFirstName(),e.getPerson().getLastName(),e.getPerson().getClubName(),e.getScore(),e.getShido()]}o.call(this,e("white",this[" fight"].getWhiteOpponent()));o.call(this,e("red",this[" fight"].getRedOpponent()));o.call(this,["new","fight",this[" fight"].getTimeLeft(),this[" fight"][" settings"].getCountUpLimit(),this[" fight"][" settings"].getCountUpLimitIppon(),this[" fight"][" settings"].isGripDisplayInverted(),this[" fight"][" settings"].isGripSideInverted()]);this[" fight"].isRunning()&&o.call(this,["fight","startPauseResume",this[" fight"].getTimeLeft()]);if(t=this[" fight"].getCountUp()){var i=t.isComplete()?4:t.isStopped()?3:t.isPaused()?2:1,n=this[" fight"][" settings"].isGripSideInverted()?this[" fight"].invertSide(t.side):t.side;o.call(this,["new","countup",n,t.get(),i])}}.call(this);this[" broker"].close();t.call(this,"establish","peer opened");i.resolve()}.bind(this);this[" conn"].onclose=function(){this[" connected"]=!1;t.call(this,"disconnect","peer closed")}.bind(this);return i.promise},disconnect:function(){return this[" connected"]&&this[" conn"].close()||!0},isConnected:function(){return this[" connected"]},on:function(t,e){var i=Object.keys(this[" listener"]);if(-1===i.indexOf(t))throw new RangeError("Only following values are allowed for event type: "+i.join(", ")+"!");this[" listener"][t].push(e);return this},getFight:function(){return this[" fight"]},replaceFight:function(t){this.disconnect();this[" fight"].clearListeners();delete this[" fight"];this[" fight"]=t;s.call(this)}};function o(t){this.isConnected()&&this[" conn"].send(JSON.stringify(t))}function s(){var t=this[" fight"].getRedOpponent(),e=this[" fight"].getWhiteOpponent();this[" fight"].on("reset",function(t){o.call(this,["fight","reset",t])}.bind(this));this[" fight"].on("startPauseResume",function(t){o.call(this,["fight","startPauseResume",t])}.bind(this));this[" fight"].on("stop",function(t){o.call(this,["fight","stop",t[0],t[1],t[2]])}.bind(this));this[" fight"].on("toketa",function(t){o.call(this,["fight","toketa",t])}.bind(this));this[" fight"].on("osaeKomi",function(t){o.call(this,["fight","osaeKomi",t])}.bind(this));this[" fight"].on("removeCountUp",function(){o.call(this,["fight","removeCountUp"])}.bind(this));t.on("add",function(t){o.call(this,["red","add"+t])}.bind(this)).on("remove",function(t){o.call(this,["red","remove"+t])}.bind(this));e.on("add",function(t){o.call(this,["white","add"+t])}.bind(this)).on("remove",function(t){o.call(this,["white","remove"+t])}.bind(this))}function t(t,e){this[" listener"][t].forEach(function(t){t.call(this,e)},this)}return{create:function(t,e){return new n(t,e)}}});!function(t,e){if("function"==typeof define&&define.amd)define("direzione-lib/service/FightReceiverLocal",["direzione-lib/service/LocalBroker","direzione-lib/model/Fight","direzione-lib/config/FightSettings","direzione-lib/model/Opponent","direzione-lib/model/Person","direzione-lib/view/Scoreboard"],e);else if("object"==typeof module&&module.exports)module.exports=e(require("./LocalBroker"),require("../model/Fight"),require("../config/FightSettings"),require("../model/Opponent"),require("../model/Person"),require("../view/Scoreboard"));else{t.Direzione=t.Direzione||{};t.Direzione.FightReceiverLocal=e(t.Direzione.LocalBroker,t.Direzione.Fight,t.Direzione.FightSettings,t.Direzione.Opponent,t.Direzione.Person,t.Direzione.Scoreboard)}}(this,function(i,n,o,s,r,h){function u(t,e){this[" localPeer"]=new RTCPeerConnection;this[" receiverID"]=t;this[" connected"]=!1;this[" conn"]=!1;this[" viewConfig"]=e;this[" listener"]={disconnect:[],establish:[]};this[" redOpponent"]=null;this[" whiteOpponent"]=null;this[" fight"]=null;this[" board"]=null;this[" initValMemCountdown"]=e.outputElemCountdown.innerText;!function(){var e=i.create(this[" localPeer"]);this[" broker"]=e;this[" localPeer"].onicecandidate=function(t){e.send({candidate:t.candidate})};this[" localPeer"].onnegotiationneeded=function(){this[" localPeer"].createOffer().then(function(t){return this[" localPeer"].setLocalDescription(t)}.bind(this)).then(function(){e.send({sdp:this[" localPeer"].localDescription})}.bind(this))}.bind(this)}.call(this);!function(){this[" localPeer"].ondatachannel=function(t){this[" conn"]=t.channel;this[" conn"].onmessage=function(t){!function(t){if("new"===t[0])switch(t[1]){case"red":return this[" redOpponent"]=s.create(r.create(t[2],t[3],t[4]),t[5],t[6]);case"white":return this[" whiteOpponent"]=s.create(r.create(t[2],t[3],t[4]),t[5],t[6]);case"fight":var e=o.create();e.setDuration(t[2]).setCountUpLimit(t[3]).setCountUpLimitIppon(t[4]).setGripDisplayInverted(t[5]).setGripSideInverted(t[6]);this[" viewConfig"].outputElemCountdown.innerText=this[" initValMemCountdown"];this[" fight"]=n.create(e,this[" whiteOpponent"],this[" redOpponent"],!0);this[" board"]=h.create(this[" fight"],this[" viewConfig"]);return;case"countup":this[" fight"].osaeKomi(t[2],t[3]);return-1!==[4,3,2].indexOf(t[4])?this[" fight"].toketa(t[3]):void 0}switch(t[0]){case"fight":return this[" fight"][t[1]](3<=t.length?t[2]:void 0,4<=t.length?t[3]:void 0,5<=t.length?t[4]:void 0);case"red":return this[" redOpponent"][t[1]]();case"white":return this[" whiteOpponent"][t[1]]()}}.call(this,JSON.parse(t.data))}.bind(this);this[" conn"].onopen=function(){this[" connected"]=!0;this[" broker"].close();c.call(this,"establish","peer opened")}.bind(this);this[" conn"].onclose=function(){this[" connected"]=!1;this[" board"].shutdown();c.call(this,"disconnect","peer closed")}.bind(this)}.bind(this)}.call(this)}u.prototype={isConnected:function(){return this[" connected"]},on:function(t,e){var i=Object.keys(this[" listener"]);if(-1===i.indexOf(t))throw new RangeError("Only following values are allowed for event type: "+i.join(", ")+"!");this[" listener"][t].push(e);return this}};function c(t,e){this[" listener"][t].forEach(function(t){t.call(this,e)},this)}return{create:function(t,e){return new u(t,e)}}});!function(t,e){if("function"==typeof define&&define.amd)define("direzione-lib/view/Repertoire",["direzione-lib/util/Utils"],e);else if("object"==typeof module&&module.exports)module.exports=e(require("../util/Utils"));else{t.Direzione=t.Direzione||{};t.Direzione.Repertoire=e(t.Direzione.Utils)}}(this,function(o){function i(t,e){this[" tournament"]=t;this[" entryJig"]=e.entryJigElem.cloneNode(!0);this[" entryWrapper"]=e.entryWrapperElem;this[" cssWhiteName"]=e.selectorWhiteOpponentName||".white";this[" cssRedName"]=e.selectorRedOpponentName||".red";this[" cssWhiteLockOut"]=e.selectorWhiteOpponentLockOut;this[" cssRedLockOut"]=e.selectorRedOpponentLockOut;e.entryJigElem.remove();this[" entryJig"].removeAttribute("id");s.call(this);n.call(this)}i.prototype={refresh:function(){!function(){var t=this[" entryWrapper"].childNodes;for(;0<t.length;)t[0].remove()}.call(this);s.call(this)}};function n(){this[" entryWrapper"].querySelectorAll(this[" entryJig"].tagName).forEach(function(t){if(void 0!==t.fight){var e=t.fight.getWhiteOpponent().getPerson().getLockOut(),i=t.fight.getRedOpponent().getPerson().getLockOut(),n=t.querySelector(this[" cssWhiteLockOut"]),t=t.querySelector(this[" cssRedLockOut"]);n&&(n.innerText=!e||e.get()<1?"-:--":o.getMinSecDisplay(e.get()));t&&(t.innerText=!i||i.get()<1?"-:--":o.getMinSecDisplay(i.get()))}}.bind(this));requestAnimationFrame(n.bind(this))}function s(){var t,e,i=this[" tournament"].getPlaylist();i.reset();for(;t=i.next();){e=this[" entryJig"].cloneNode(!0);t.on("stop",function(){this.classList.contains("running")&&this.classList.remove("running");this.classList.contains("completed")||this.classList.add("completed")}.bind(e)).on("reset",function(){this.classList.contains("running")&&this.classList.remove("running");this.classList.contains("completed")&&this.classList.remove("completed")}.bind(e)).on("startPauseResume",function(){this.classList.contains("running")||this.classList.add("running")}.bind(e));e.fight=t;e.querySelector(this[" cssWhiteName"]).innerText=t.getWhiteOpponent().getFullName();e.querySelector(this[" cssRedName"]).innerText=t.getRedOpponent().getFullName();this[" entryWrapper"].appendChild(e)}}return{create:function(t,e){return new i(t,e)}}});!function(t,e){if("function"==typeof define&&define.amd)define("direzione-lib/util/RingIterator",e);else if("object"==typeof module&&module.exports)module.exports=e();else{t.Direzione=t.Direzione||{};t.Direzione.RingIterator=e()}}(this,function(){function e(t){this[" arr"]=t;this[" values"]=t.values();this[" turn"]=1}e.prototype={next:function(){var t=this[" values"].next();if(t.done){this[" values"]=this[" arr"].values();this[" turn"]++;return this[" values"].next().value}return t.value},getTurn:function(){return this[" turn"]}};return{create:function(t){return new e(t)}}});!function(t,e){if("function"==typeof define&&define.amd)define("direzione-lib/util/RoundRobinTournamentIterator",["direzione-lib/util/RingIterator"],e);else if("object"==typeof module&&module.exports)module.exports=e(require("./RingIterator"));else{t.Direzione=t.Direzione||{};t.Direzione.RoundRobinTournamentIterator=e(t.Direzione.RingIterator)}}(this,function(e){function i(t){if(t.length<2)throw new RangeError("Provide an array with at least two elements!");t.length%2&&t.push(null);this[" startPos"]=1;this[" break"]=!1;this[" maxTurns"]=t.length;this[" half"]=Math.floor((t.length-1)/2);this[" iterator"]=e.create(t);this[" queue"]=[];this[" postQueue"]=[];this[" stack"]=[];this[" postStack"]=[]}i.prototype={next:function(){var t,e,i=this[" half"],n=this[" iterator"];if(0<this[" queue"].length)return this[" break"]=1===this[" queue"].length&&n.getTurn()<this[" maxTurns"]-1,[this[" stack"].pop(),this[" queue"].shift()];if(this[" break"])return this[" break"]=!1,[];for(var o=this[" startPos"];;o++){e=n.next();t=n.getTurn();if(this[" maxTurns"]<=t)return null;if(o===t)this[" satellite"]=e;else{if(o===this[" maxTurns"]){this[" stack"]=this[" stack"].concat(this[" postStack"]);this[" queue"]=this[" queue"].concat(this[" postQueue"]);this[" postStack"]=[];this[" postQueue"]=[];return null!==e?[e,this[" satellite"]]:(this[" break"]=1===this[" queue"].length&&n.getTurn()<this[" maxTurns"]-1,[this[" stack"].pop(),this[" queue"].shift()])}o<=t+i&&t<o?this[" queue"].push(e):t+i<o&&o<=t+2*i?this[" stack"].push(e):o<t&&t-i<=o?this[" postStack"].push(e):o<t-i&&this[" postQueue"].push(e)}}}};return{create:function(t){return new i(t)}}});!function(t,e){if("function"==typeof define&&define.amd)define("direzione-lib/model/Tournament",["direzione-lib/model/Fight","direzione-lib/model/FightHistory","direzione-lib/config/FightSettings","direzione-lib/model/Opponent","direzione-lib/model/OpponentGroup","direzione-lib/model/Person","direzione-lib/view/Scoreboard","direzione-lib/service/FightEmitter","direzione-lib/service/FightReceiver","direzione-lib/service/FightEmitterLocal","direzione-lib/service/FightReceiverLocal","direzione-lib/service/LocalBroker","direzione-lib/model/Playlist","direzione-lib/view/Repertoire","direzione-lib/util/Utils","direzione-lib/util/RingIterator","direzione-lib/util/RoundRobinTournamentIterator"],e);else if("object"==typeof module&&module.exports)module.exports=e(require("./Fight"),require("./FightHistory"),require("../config/FightSettings"),require("./Opponent"),require("./OpponentGroup"),require("./Person"),require("../view/Scoreboard"),require("../service/FightEmitter"),require("../service/FightReceiver"),require("../service/FightEmitterLocal"),require("../service/FightReceiverLocal"),require("../service/LocalBroker"),require("./Playlist"),require("../view/Repertoire"),require("../util/Utils"),require("../util/RingIterator"),require("../util/RoundRobinTournamentIterator"));else{t.Direzione=e(t.Direzione.Fight,t.Direzione.FightHistory,t.Direzione.FightSettings,t.Direzione.Opponent,t.Direzione.OpponentGroup,t.Direzione.Person,t.Direzione.Scoreboard,t.Direzione.FightEmitter,t.Direzione.FightReceiver,t.Direzione.FightEmitterLocal,t.Direzione.FightReceiverLocal,t.Direzione.LocalBroker,t.Direzione.Playlist,t.Direzione.Repertoire,t.Direzione.Utils,t.Direzione.RingIterator,t.Direzione.RoundRobinTournamentIterator);t.Direzione.Tournament={create:t.Direzione.create}}}(this,function(i,t,e,n,o,s,r,h,u,c,l,a,d,f,p,g,m){function v(t){this[" groups"]=[];this[" playlist"]=d.create();this[" fightSettings"]=t}v.prototype={addGroup:function(t){this[" groups"].push(t);return this},setGroups:function(t){this[" groups"]=t;return this},setName:function(t){this[" name"]=t;return this},build:function(e){var t,i,n,o=0,s=[];this[" iterators"]=[];"create"in e||new TypeError("Not an iterator!");this[" groups"].forEach(function(t){this[" iterators"].push(e.create(t.getPersons()));s.push(!1)},this);t=g.create(this[" iterators"]);for(;i=t.next();){for(;;){if(null===(n=i.next())){s[o%this[" iterators"].length]=!0;break}if(0===n.length)break;w.call(this,n[0],n[1])}if(s.every(function(t){return t}))return;o++}},getPlaylist:function(){return this[" playlist"]},toStruct:function(){return{name:this[" name"],groups:this[" groups"].map(function(t){return t.toStruct()})}}};function b(){var t=new Audio(this[" fightSettings"].getTimeUpSoundFile());t.currentTime=0;t.oncanplay=function(){t.play()}}function w(t,e){t=i.create(this[" fightSettings"],n.create(t),n.create(e));this[" playlist"].insert(t.on("timeUp",b.bind(this)));return t}return{Fight:i,FightHistory:t,FightSettings:e,Opponent:n,OpponentGroup:o,Person:s,Scoreboard:r,FightEmitter:h,FightReceiver:u,FightEmitterLocal:c,FightReceiverLocal:l,LocalBroker:a,Playlist:d,Repertoire:f,Utils:p,RingIterator:g,RoundRobinTournamentIterator:m,create:function(t){return new v(t)}}});"function"==typeof define&&define.amd&&define(["direzione-lib/model/Tournament"],function(t){return t});