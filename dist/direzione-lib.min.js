/**
 * Direzione Library v0.15.0
 *
 * A library of components that can be used to manage a martial arts tournament
 *
 * Copyright (C) 2023 Daniel Moritz
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, in version 3 of the License.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>
 */!function(t,e){if("function"==typeof define&&define.amd)define("direzione-lib/model/FightHistory",e);else if("object"==typeof module&&module.exports)module.exports=e();else{t.Direzione=t.Direzione||{};t.Direzione.FightHistory=e()}}(this,function(){function e(t){this[" fight"]=t;this[" log"]=[];this.registerEventListeners()}(e.prototype={getFight:function(){return this[" fight"]},getLog:function(){return JSON.parse(JSON.stringify(this[" log"]))}}).insert=function(t,e){var i,n=t;if("removeCountUp"!==t){for(;"startPauseResume"===t;){if(0===this[" log"].length){n="start";break}n=(i=this[" fight"].getCountdown())&&i.isPaused()?"pause":"resume";break}this[" log"].push([Date.now()].concat(n,e))}};e.prototype.registerEventListeners=function(){this[" fight"].getWhiteOpponent().on("add",t.bind(this,"white","add")).on("remove",t.bind(this,"white","remove"));this[" fight"].getRedOpponent().on("add",t.bind(this,"red","add")).on("remove",t.bind(this,"red","remove"))};function t(t,e,i){this[" log"].push([Date.now(),t,e,i])}return{create:function(t){return new e(t)}}});!function(t,e){if("function"==typeof define&&define.amd)define("direzione-lib/model/Fight",["durata/dist/durata.min","direzione-lib/model/FightHistory"],e);else if("object"==typeof module&&module.exports)module.exports=e(require("durata"),require("./FightHistory"));else{t.Direzione=t.Direzione||{};t.Direzione.Fight=e(t.Durata,t.Direzione.FightHistory)}}(this,function(s,o){function r(t,e,i,n){this[" settings"]=t;this[" whiteOpponent"]=e;this[" redOpponent"]=i;this[" history"]=(void 0===n||!n)&&o.create(this);this[" stopped"]=!1;this[" listener"]={reset:[],startPauseResume:[],osaeKomi:[],stop:[],toketa:[],removeCountUp:[]}}r.DURATION=18e4;r.COUNTUP=1e4;r.LOCK_OUT=6e5;r.SIDE_WHITE="white";r.SIDE_RED="red";r.SIDE_CENTER="center";r.prototype={clearListeners:function(t){t=void 0===t||t;Object.keys(this[" listener"]).forEach(function(t){delete this[" listener"][t];this[" listener"][t]=[]},this);this.getRedOpponent().clearListeners();this.getWhiteOpponent().clearListeners();t&&this.getHistory()&&this.getHistory().registerEventListeners()},getHistory:function(){return this[" history"]},getCountdown:function(){return i.call(this)&&this[" countdown"]},getCountUp:function(){return h.call(this)&&this[" countup"]},getWhiteOpponent:function(){return this[" whiteOpponent"]},getRedOpponent:function(){return this[" redOpponent"]},getTimeLeft:function(){return i.call(this)?this[" countdown"].get():this[" settings"].getDuration()},isRunning:function(){return!this[" stopped"]&&i.call(this)&&!this[" countdown"].isPaused()&&!this[" countdown"].isComplete()},isStopped:function(){return this[" stopped"]},on:function(t,e){var i=Object.keys(this[" listener"]);if(-1===i.indexOf(t))throw new RangeError("Only following values are allowed for event type: "+i.join(", ")+"!");this[" listener"][t].push(e);return this},removeCountUp:n,reset:function(t){this[" stopped"]=!1;n.call(this);i.call(this)&&this[" countdown"].stop("interrupt");u.call(this,t);this[" countdown"].pause("reset");this[" whiteOpponent"].reset();this[" redOpponent"].reset();void 0===t&&p.call(this,"reset",i.call(this)?this[" countdown"].get():void 0)},startPauseResume:function(t){if(!this.isStopped()){if(i.call(this)){if(this[" countdown"].isComplete())return;if(void 0!==t){var e=this[" countdown"].isPaused();u.call(this,t);e&&this[" countdown"].pause("renew")}!function(){this.isStopped()||this[" countdown"].isPaused()&&this[" countdown"].resume("toggle")||this[" countdown"].pause("toggle")}.call(this)}else u.call(this,t);void 0===t&&p.call(this,"startPauseResume",this[" countdown"].get())}},osaeKomi:function(t,e){t=t||r.SIDE_CENTER;if(void 0!==e||!this.isStopped()&&i.call(this)&&!this[" countdown"].isPaused()){!h.call(this)||this[" countup"].isPaused()||void 0!==e?c.call(this,t,e):this[" countup"].side=t;void 0===e&&p.call(this,"osaeKomi",t)}},stop:l,toketa:d};function i(){return void 0!==this[" countdown"]}function h(){return void 0!==this[" countup"]}function n(){if(h.call(this)){this[" countup"].stop("reset");delete this[" countup"];p.call(this,"removeCountUp")}}function u(t){var e=void 0!==t?t:this[" settings"].getDuration();i.call(this)&&this[" countdown"].stop("dirty");this[" countdown"]=s.create(e,0,e).on("resume",n.bind(this));void 0===t&&this[" countdown"].on("complete",l.bind(this)).on("pause",d.bind(this,void 0))}function c(t,e){var i=e||0,n=this[" settings"].getCountUpLimit(),o=void 0!==e?this[" settings"].getCountUpLimitIppon():n;h.call(this)&&this[" countup"].stop("dirty");this[" countup"]=s.create(i,o,o-i);this[" countup"].side=t;void 0===e&&this[" countup"].on("pause",function(){p.call(this,"toketa",this[" countup"].get())}.bind(this)).on("complete",function(){if(0!==this[" "+this[" countup"].side+"Opponent"].getScore())this[" countdown"].isPaused()||this[" countdown"].pause("osaekomi-timeup");else{this[" countup"].stop("replace");c.call(this,this[" countup"].side,n);this[" countup"].on("pause",function(){p.call(this,"toketa",this[" countup"].get())}.bind(this)).on("complete",function(){this[" countdown"].isPaused()||this[" countdown"].pause("osaekomi-timeup")}.bind(this))}}.bind(this))}function l(t,e,i){this[" stopped"]=!0;if(void 0===t)this[" countdown"].stop("timeup");else{u.call(this,t);this[" countdown"].stop("timeup");c.call(this,i,e)}h.call(this)&&this[" countup"].stop("timeup");if(void 0===t){this[" whiteOpponent"].getPerson().setLockOut(this[" settings"].getLockOutTime());this[" redOpponent"].getPerson().setLockOut(this[" settings"].getLockOutTime());p.call(this,"stop",[this[" countdown"].get(),h.call(this)?this[" countup"].get():0,h.call(this)?this[" countup"].side:r.SIDE_CENTER])}}function d(t){if(!this.isStopped()&&h.call(this)){void 0!==t&&c.call(this,this[" countup"].side,t);this[" countup"].pause("toketa")}}function p(t,e){this[" history"]&&this[" history"].insert(t,e);this[" listener"][t].forEach(function(t){t.call(this,e)},this)}return{create:function(t,e,i,n){return new r(t,e,i,n)},DURATION:r.DURATION,COUNTUP:r.COUNTUP,LOCK_OUT:r.LOCK_OUT,SIDE_WHITE:r.SIDE_WHITE,SIDE_RED:r.SIDE_RED,SIDE_CENTER:r.SIDE_CENTER}});!function(t,e){if("function"==typeof define&&define.amd)define("direzione-lib/config/FightSettings",["direzione-lib/model/Fight"],e);else if("object"==typeof module&&module.exports)module.exports=e(require("../model/Fight"));else{t.Direzione=t.Direzione||{};t.Direzione.FightSettings=e(t.Direzione.Fight)}}(this,function(t){var e=["duration","countUpLimit","countUpLimitIppon","personLockOut"];function i(){this.duration=t.DURATION;this.countUpLimit=t.COUNTUP;this.countUpLimitIppon=2*t.COUNTUP;this.personLockOut=t.LOCK_OUT;this.fromStorage();this.fromURLParameters()}i.prototype={toStorage:function(){localStorage.setItem("Direzione.FightSettings",JSON.stringify(this))},fromStorage:function(){var e,t=localStorage.getItem("Direzione.FightSettings");if(t){e=JSON.parse(t);Object.keys(e).forEach(function(t){this[t]=e[t]},this)}},fromURLParameters:function(){var t=new URLSearchParams(window.location.search);Array.from(t.entries()).forEach(function(t){e.includes(t[0])&&(this[t[0]]=t[1])},this)},getDuration:function(){return this.duration},getCountUpLimit:function(){return this.countUpLimit},getCountUpLimitIppon:function(){return this.countUpLimitIppon},getLockOutTime:function(){return this.personLockOut},setDuration:function(t){if(!Number.isInteger(t))throw TypeError("Duration has to be of type integer");this.duration=t;return this},setCountUpLimit:function(t){if(!Number.isInteger(t))throw TypeError("Limit for count up (wazari) has to be of type integer");this.countUpLimit=t;return this},setCountUpLimitIppon:function(t){if(!Number.isInteger(t))throw TypeError("Limit for count up (ippon) has to be of type integer");this.countUpLimitIppon=t;return this},setLockOutTime:function(t){if(!Number.isInteger(t))throw TypeError("The lock-out time has to be of type integer");this.personLockOut=t;return this}};return{create:function(){return new i}}});!function(t,e){if("function"==typeof define&&define.amd)define("direzione-lib/model/Opponent",e);else if("object"==typeof module&&module.exports)module.exports=e();else{t.Direzione=t.Direzione||{};t.Direzione.Opponent=e()}}(this,function(){var i=["add","remove","reset"];function n(t,e,i){this[" person"]=t;this[" score"]=e||0;this[" penalty"]=i||0;this[" listener"]={add:[],remove:[],reset:[]}}n.SCORE_WAZARI=4;n.MAX_SCORE=n.SCORE_IPPON=8;n.MAX_PENALTY=3*(n.PENALTY_SHIDO=1);n.prototype={clearListeners:function(){Object.keys(this[" listener"]).forEach(function(t){delete this[" listener"][t];this[" listener"][t]=[]},this)},addIppon:function(){if(!(this[" score"]>=n.MAX_SCORE)){t.call(this,"add","Ippon");this[" score"]=n.SCORE_IPPON}},addShido:function(){if(!(this[" penalty"]>=n.MAX_PENALTY)){t.call(this,"add","Shido");this[" penalty"]=this[" penalty"]+n.PENALTY_SHIDO}},addWazari:function(){if(!(this[" score"]>=n.MAX_SCORE)){t.call(this,"add","Wazari");this[" score"]=this[" score"]+n.SCORE_WAZARI}},getPerson:function(){return this[" person"]},getFullName:function(){return this.getPerson().getFirstName()+" "+this.getPerson().getLastName()},getScore:function(){return this[" score"]>=n.MAX_SCORE?n.MAX_SCORE:this[" score"]},getShido:function(){return this[" penalty"]>=n.MAX_PENALTY?n.MAX_PENALTY:this[" penalty"]},on:function(t,e){if(-1===i.indexOf(t))throw new RangeError("Only following values are allowed for event type: "+i.join(", ")+"!");this[" listener"][t].push(e);return this},removeIppon:function(){if(!(this[" score"]-n.SCORE_IPPON<0)){t.call(this,"remove","Ippon");this[" score"]=this[" score"]-n.SCORE_IPPON}},removeShido:function(){if(!(this[" penalty"]<=0)){t.call(this,"remove","Shido");this[" penalty"]=this[" penalty"]-n.PENALTY_SHIDO}},removeWazari:function(){if(!(this[" score"]<=0)){t.call(this,"remove","Wazari");this[" score"]=this[" score"]-n.SCORE_WAZARI}},reset:function(){t.call(this,"reset");this[" score"]=0;this[" penalty"]=0;this.getPerson().reset()}};function t(t,e){this[" listener"][t].forEach(function(t){t.call(this,e)},this)}return{create:function(t,e,i){return new n(t,e,i)}}});!function(t,e){if("function"==typeof define&&define.amd)define("direzione-lib/model/Person",["durata/dist/durata.min"],e);else if("object"==typeof module&&module.exports)module.exports=e(require("durata"));else{t.Direzione=t.Direzione||{};t.Direzione.Person=e(t.Durata)}}(this,function(e){function n(t,e,i){this[" firstName"]=t;this[" lastName"]=e;this[" club"]=i}n.prototype={getClubName:function(){return this[" club"]},getFirstName:function(){return this[" firstName"]},getLastName:function(){return this[" lastName"]},setLockOut:function(t){this.reset();this[" lockout"]=e.create(t,0,t)},getLockOut:function(){return void 0!==this[" lockout"]&&this[" lockout"]},reset:function(){void 0!==this[" lockout"]&&this[" lockout"].stop();delete this[" lockout"]}};return{create:function(t,e,i){return new n(t,e,i)}}});!function(t,e){if("function"==typeof define&&define.amd)define("direzione-lib/model/Playlist",e);else if("object"==typeof module&&module.exports)module.exports=e();else{t.Direzione=t.Direzione||{};t.Direzione.Playlist=e()}}(this,function(){function t(){this[" cursor"]=void 0;this[" head"]=void 0;this[" tail"]=void 0;this[" length"]=0;this[" eof"]=!1}t.prototype={find:i,insert:function(t){t=new e(this,t);if(this[" length"])if(void 0===this[" cursor"]){(this[" head"][" prev"]=t)[" next"]=this[" head"];this[" head"]=t}else{void 0===this[" cursor"][" next"]?this[" tail"]=t:this[" cursor"][" next"][" prev"]=t;t[" next"]=this[" cursor"][" next"];(this[" cursor"][" next"]=t)[" prev"]=this[" cursor"];this[" cursor"]=t}else{this[" head"]=t;this[" tail"]=t;this[" cursor"]=t}this[" length"]++;this[" eof"]=!1;return this[" length"]},includes:n,next:function(){if(this[" cursor"]===this[" tail"])return this[" eof"]=!0,void 0;var t=this[" cursor"]?this[" cursor"][" next"]:this[" head"];return(this[" cursor"]=t)&&t[" value"]},prev:function(){var t;if(this[" eof"]){this[" eof"]=!1;t=this[" cursor"]=this[" tail"]}else{t=this[" cursor"]&&this[" cursor"][" prev"];this[" cursor"]=t}return t&&t[" value"]},reset:o,remove:function(t,e){if(n.call(this,t,e)){t=this[" cursor"];!function(){if(this[" list"]){this[" prev"]&&(this[" prev"][" next"]=this[" next"]);this[" next"]&&(this[" next"][" prev"]=this[" prev"]);this===this[" list"][" cursor"]&&(this[" list"][" cursor"]=this[" next"]||this[" prev"]);this===this[" list"][" head"]&&(this[" list"][" head"]=this[" next"]);this===this[" list"][" tail"]&&(this[" list"][" tail"]=this[" prev"]);this[" list"][" length"]--;this[" prev"]=void 0;this[" next"]=void 0;this[" list"]=void 0}}.call(t);o.call(this);return t[" value"]}}};function e(t,e){this[" list"]=t;this[" value"]=e;this[" prev"]=void 0;this[" next"]=void 0}function i(t,e){if("function"!=typeof t)throw new TypeError("You must provide a function as first argument");if(this[" length"]){(e=e||0)<0&&(e=this[" length"]+e);for(var i=this[" head"],n=0;n<this[" length"];n++){if(e<=n&&t(i[" value"],n)){this[" cursor"]=i;this[" eof"]=!1;return i[" value"]}i=i[" next"]}this[" cursor"]=void 0}}function n(e,t){i.call(this,function(t){return Object.is(t,e)},t);return!!this[" cursor"]}function o(){this[" cursor"]=void 0;this[" eof"]=!1;return this}return{create:function(){return new t}}});!function(t,e){if("function"==typeof define&&define.amd)define("direzione-lib/util/Utils",e);else if("object"==typeof module&&module.exports)module.exports=e();else{t.Direzione=t.Direzione||{};t.Direzione.Utils=e()}}(this,function(){return{loadTranslationJS:function(t,e){var i=document.createElement("script");i.onload=function(){e(Direzione.translation)};i.src=t;document.head.appendChild(i)},getMinSecDisplay:function(t){t=Math.ceil(t/1e3);return Math.floor(t/60)+":"+(t%60+"").padStart(2,"0")}}});!function(t,e){if("function"==typeof define&&define.amd)define("direzione-lib/view/Scoreboard",["direzione-lib/model/Fight","direzione-lib/util/Utils"],e);else if("object"==typeof module&&module.exports)module.exports=e(require("../model/Fight"),require("../util/Utils"));else{t.Direzione=t.Direzione||{};t.Direzione.Scoreboard=e(t.Direzione.Fight,t.Direzione.Utils)}}(this,function(i,n){function o(t,e){this[" fight"]=t;this[" outputElems"]={countdown:e.outputElemCountdown,clockSec:e.outputElemStopwatchSeconds,clockMSec:e.outputElemStopwatchMilliseconds,whiteScore:e.outputElemWhiteScore,redScore:e.outputElemRedScore,whiteShido:e.outputElemWhiteShido,redShido:e.outputElemRedShido,whiteOpponent:e.outputElemWhiteOpponent,redOpponent:e.outputElemRedOpponent,whiteClub:e.outputElemWhiteClub,redClub:e.outputElemRedClub};this[" initValMemCountdown"]=e.outputElemCountdown.innerText;this.showNames();this.run()}o.prototype={replaceFight:function(t){this.stop();this[" fight"]=t;this.showNames();this.run()},run:function(){this[" allowRun"]=!0;requestAnimationFrame(this[" animationLoop"]=function(){!function(){this[" outputElems"].countdown.innerText=n.getMinSecDisplay(this[" fight"].getTimeLeft());var t=this[" fight"].getCountUp();if(t){var e=t.get();this[" outputElems"].clockSec.innerText=r(e);this[" outputElems"].clockMSec.innerText=s(e);this[" outputElems"].clockSec.parentNode.className=t.side}else{this[" outputElems"].clockSec.innerText=r(0);this[" outputElems"].clockMSec.innerText=s(0);this[" outputElems"].clockSec.parentNode.className=i.SIDE_CENTER}this[" outputElems"].whiteScore.innerText=this[" fight"].getWhiteOpponent().getScore();this[" outputElems"].redScore.innerText=this[" fight"].getRedOpponent().getScore();this[" outputElems"].whiteShido.innerText=this[" fight"].getWhiteOpponent().getShido();this[" outputElems"].redShido.innerText=this[" fight"].getRedOpponent().getShido()}.call(this);this[" allowRun"]?requestAnimationFrame(this[" animationLoop"]):this[" allowRun"]=!0}.bind(this))},stop:function(){this[" allowRun"]=!1},showNames:function(){this[" outputElems"].whiteOpponent.innerText=this[" fight"].getWhiteOpponent().getFullName();this[" outputElems"].redOpponent.innerText=this[" fight"].getRedOpponent().getFullName();this[" outputElems"].whiteClub.innerText=this[" fight"].getWhiteOpponent().getPerson().getClubName();this[" outputElems"].redClub.innerText=this[" fight"].getRedOpponent().getPerson().getClubName()},hideNames:function(){this[" outputElems"].whiteOpponent.innerText="";this[" outputElems"].redOpponent.innerText="";this[" outputElems"].whiteClub.innerText="";this[" outputElems"].redClub.innerText=""},shutdown:function(){this.stop();this.hideNames();requestAnimationFrame(function(){this[" outputElems"].countdown.innerText=this[" initValMemCountdown"];this[" outputElems"].clockSec.innerText=r(0);this[" outputElems"].clockMSec.innerText=s(0);this[" outputElems"].clockSec.parentNode.className=i.SIDE_CENTER;this[" outputElems"].whiteScore.innerText=0;this[" outputElems"].redScore.innerText=0;this[" outputElems"].whiteShido.innerText=0;this[" outputElems"].redShido.innerText=0}.bind(this))}};function s(t){return(Math.floor(t%1e3)+"").padStart(3,"0")}function r(t){return Math.floor(t/1e3)%60}return{create:function(t,e){return new o(t,e)}}});!function(t,e){if("function"==typeof define&&define.amd)define("direzione-lib/service/FightEmitter",["peerjs/dist/peerjs.min"],e);else if("object"==typeof module&&module.exports)module.exports=e(require("peerjs"));else{t.Direzione=t.Direzione||{};t.Direzione.FightEmitter=e(t.peerjs)}}(this,function(n){var i=["disconnect","establish"];function o(t,e,i){i=i||[];this[" localPeer"]=new n.Peer(i.length<1?void 0:{config:{iceServers:i}});this[" fight"]=e;this[" receiverID"]=t;this[" connected"]=!1;this[" conn"]=!1;this[" listener"]={disconnect:[],establish:[]};r.call(this)}o.prototype={connect:function(){var i={resolve:null,reject:null};i.promise=new Promise(function(t,e){i.resolve=t;i.reject=e});this[" conn"]=this[" localPeer"].connect(this[" receiverID"]);this[" conn"].on("open",function(){this[" connected"]=!0;!function(){var t;function e(t,e){return["new",t,e.getPerson().getFirstName(),e.getPerson().getLastName(),e.getPerson().getClubName(),e.getScore(),e.getShido()]}s.call(this,e("white",this[" fight"].getWhiteOpponent()));s.call(this,e("red",this[" fight"].getRedOpponent()));s.call(this,["new","fight",this[" fight"].getTimeLeft(),this[" fight"][" settings"].getCountUpLimit(),this[" fight"][" settings"].getCountUpLimitIppon()]);this[" fight"].isRunning()&&s.call(this,["fight","startPauseResume",this[" fight"].getTimeLeft()]);if(t=this[" fight"].getCountUp()){var i=t.isComplete()?4:t.isStopped()?3:t.isPaused()?2:1;s.call(this,["new","countup",t.side,t.get(),i])}}.call(this);t.call(this,"establish","peer opened");i.resolve()}.bind(this));this[" conn"].on("close",function(){this[" connected"]=!1;t.call(this,"disconnect","peer closed")}.bind(this));return i.promise},disconnect:function(){this[" connected"]&&this[" conn"].close()},isConnected:function(){return this[" connected"]},on:function(t,e){if(-1===i.indexOf(t))throw new RangeError("Only following values are allowed for event type: "+i.join(", ")+"!");this[" listener"][t].push(e);return this},getFight:function(){return this[" fight"]},replaceFight:function(t){this.disconnect();this[" fight"].clearListeners();delete this[" fight"];this[" localPeer"].destroy();delete this[" localPeer"];this[" localPeer"]=new n.Peer;this[" fight"]=t;r.call(this)}};function s(t){this.isConnected()&&this[" conn"].send(t)}function r(){var t=this[" fight"].getRedOpponent(),e=this[" fight"].getWhiteOpponent();this[" fight"].on("reset",function(t){s.call(this,["fight","reset",t])}.bind(this));this[" fight"].on("startPauseResume",function(t){s.call(this,["fight","startPauseResume",t])}.bind(this));this[" fight"].on("stop",function(t){s.call(this,["fight","stop",t[0],t[1],t[2]])}.bind(this));this[" fight"].on("toketa",function(t){s.call(this,["fight","toketa",t])}.bind(this));this[" fight"].on("osaeKomi",function(t){s.call(this,["fight","osaeKomi",t])}.bind(this));this[" fight"].on("removeCountUp",function(){s.call(this,["fight","removeCountUp"])}.bind(this));t.on("add",function(t){s.call(this,["red","add"+t])}.bind(this)).on("remove",function(t){s.call(this,["red","remove"+t])}.bind(this));e.on("add",function(t){s.call(this,["white","add"+t])}.bind(this)).on("remove",function(t){s.call(this,["white","remove"+t])}.bind(this))}function t(t,e){this[" listener"][t].forEach(function(t){t.call(this,e)},this)}return{create:function(t,e){return new o(t,e)}}});!function(t,e){if("function"==typeof define&&define.amd)define("direzione-lib/service/FightReceiver",["peerjs/dist/peerjs.min","direzione-lib/model/Fight","direzione-lib/config/FightSettings","direzione-lib/model/Opponent","direzione-lib/model/Person","direzione-lib/view/Scoreboard"],e);else if("object"==typeof module&&module.exports)module.exports=e(require("peerjs"),require("../model/Fight"),require("../config/FightSettings"),require("../model/Opponent"),require("../model/Person"),require("../view/Scoreboard"));else{t.Direzione=t.Direzione||{};t.Direzione.FightReceiver=e(t.peerjs,t.Direzione.Fight,t.Direzione.FightSettings,t.Direzione.Opponent,t.Direzione.Person,t.Direzione.Scoreboard)}}(this,function(n,o,s,r,h,u){var i=["disconnect","establish"];function c(t,e,i){i=i||[];this[" localPeer"]=new n.Peer(t,i.length<1?void 0:{config:{iceServers:i}});this[" receiverID"]=t;this[" connected"]=!1;this[" conn"]=!1;this[" viewConfig"]=e;this[" listener"]={disconnect:[],establish:[]};this[" redOpponent"]=null;this[" whiteOpponent"]=null;this[" fight"]=null;this[" board"]=null;!function(){this[" localPeer"].on("connection",function(t){(this[" conn"]=t).on("open",function(){this[" connected"]=!0;l.call(this,"establish","peer opened");t.on("data",function(t){if("new"===t[0])switch(t[1]){case"red":return this[" redOpponent"]=r.create(h.create(t[2],t[3],t[4]),t[5],t[6]);case"white":return this[" whiteOpponent"]=r.create(h.create(t[2],t[3],t[4]),t[5],t[6]);case"fight":var e=s.create();e.setDuration(t[2]).setCountUpLimit(t[3]).setCountUpLimitIppon(t[4]);this[" fight"]=o.create(e,this[" whiteOpponent"],this[" redOpponent"],!0);this[" board"]=u.create(this[" fight"],this[" viewConfig"]);return;case"countup":this[" fight"].osaeKomi(t[2],t[3]);return-1!==[4,3,2].indexOf(t[4])?this[" fight"].toketa(t[3]):void 0}switch(t[0]){case"fight":return this[" fight"][t[1]](3<=t.length?t[2]:void 0,4<=t.length?t[3]:void 0,5<=t.length?t[4]:void 0);case"red":return this[" redOpponent"][t[1]]();case"white":return this[" whiteOpponent"][t[1]]()}}.bind(this))}.bind(this));t.on("close",function(){this[" connected"]=!1;this[" board"].shutdown();l.call(this,"disconnect","peer closed")}.bind(this))}.bind(this))}.call(this)}c.prototype={isConnected:function(){return this[" connected"]},on:function(t,e){if(-1===i.indexOf(t))throw new RangeError("Only following values are allowed for event type: "+i.join(", ")+"!");this[" listener"][t].push(e);return this}};function l(t,e){this[" listener"][t].forEach(function(t){t.call(this,e)},this)}return{create:function(t,e){return new c(t,e)}}});!function(t,e){if("function"==typeof define&&define.amd)define("direzione-lib/view/Repertoire",["direzione-lib/model/Playlist","direzione-lib/util/Utils"],e);else if("object"==typeof module&&module.exports)module.exports=e(require("../model/Playlist"),require("../util/Utils"));else{t.Direzione=t.Direzione||{};t.Direzione.Repertoire=e(t.Direzione.Playlist,t.Direzione.Utils)}}(this,function(t,o){function i(t,e){this[" playlist"]=t;this[" entryJig"]=e.entryJigElem.cloneNode(!0);this[" entryWrapper"]=e.entryWrapperElem;this[" cssWhiteName"]=e.selectorWhiteOpponentName||".white";this[" cssRedName"]=e.selectorRedOpponentName||".red";this[" cssWhiteLockOut"]=e.selectorWhiteOpponentLockOut;this[" cssRedLockOut"]=e.selectorRedOpponentLockOut;e.entryJigElem.remove();this[" entryJig"].removeAttribute("id");!function(){var t,e;this[" playlist"].reset();for(;t=this[" playlist"].next();){(e=this[" entryJig"].cloneNode(!0)).fight=t;e.querySelector(this[" cssWhiteName"]).innerText=t.getWhiteOpponent().getFullName();e.querySelector(this[" cssRedName"]).innerText=t.getRedOpponent().getFullName();this[" entryWrapper"].appendChild(e)}}.call(this);n.call(this)}function n(){this[" entryWrapper"].querySelectorAll("li").forEach(function(t){if(void 0!==t.fight){var e=t.fight.getWhiteOpponent().getPerson().getLockOut(),i=t.fight.getRedOpponent().getPerson().getLockOut(),n=t.querySelector(this[" cssWhiteLockOut"]),t=t.querySelector(this[" cssRedLockOut"]);n&&(n.innerText=!e||e.get()<1?"-:--":o.getMinSecDisplay(e.get()));t&&(t.innerText=!i||i.get()<1?"-:--":o.getMinSecDisplay(i.get()))}}.bind(this));requestAnimationFrame(n.bind(this))}return{create:function(t,e){return new i(t,e)}}});!function(t,e){"function"==typeof define&&define.amd?define("direzione-lib/model/Tournament",["direzione-lib/model/Fight","direzione-lib/model/FightHistory","direzione-lib/config/FightSettings","direzione-lib/model/Opponent","direzione-lib/model/Person","direzione-lib/view/Scoreboard","direzione-lib/service/FightEmitter","direzione-lib/service/FightReceiver","direzione-lib/model/Playlist","direzione-lib/view/Repertoire","direzione-lib/util/Utils"],e):"object"==typeof module&&module.exports?module.exports=e(require("./Fight"),require("./FightHistory"),require("../config/FightSettings"),require("./Opponent"),require("./Person"),require("../view/Scoreboard"),require("../service/FightEmitter"),require("../service/FightReceiver"),require("./Playlist"),require("../view/Repertoire"),require("../util/Utils")):t.Direzione=e(t.Direzione.Fight,t.Direzione.FightHistory,t.Direzione.FightSettings,t.Direzione.Opponent,t.Direzione.Person,t.Direzione.Scoreboard,t.Direzione.FightEmitter,t.Direzione.FightReceiver,t.Direzione.Playlist,t.Direzione.Repertoire,t.Direzione.Utils)}(this,function(t,e,i,n,o,s,r,h,u,c,l){return{Fight:t,FightHistory:e,FightSettings:i,Opponent:n,Person:o,Scoreboard:s,FightEmitter:r,FightReceiver:h,Playlist:u,Repertoire:c,Utils:l}});"function"==typeof define&&define.amd&&define(["direzione-lib/model/Tournament"],function(t){return t});