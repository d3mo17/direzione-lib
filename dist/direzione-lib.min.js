/**
 * Direzione Library v1.0.0
 *
 * A library of components that can be used to manage a martial arts tournament
 *
 * Copyright (C) 2023 Daniel Moritz
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, in version 3 of the License.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>
 */!function(e,t){if("function"==typeof define&&define.amd)define("direzione-lib/model/FightHistory",t);else if("object"==typeof module&&module.exports)module.exports=t();else{e.Direzione=e.Direzione||{};e.Direzione.FightHistory=t()}}(this,function(){function t(e){this[" fight"]=e;this[" log"]=[];this.registerEventListeners()}(t.prototype={getFight:function(){return this[" fight"]},getLog:function(){return JSON.parse(JSON.stringify(this[" log"]))}}).insert=function(e,t){var i,n=e;if("removeCountUp"!==e){for(;"startPauseResume"===e;){if(0===this[" log"].length){n="start";break}n=(i=this[" fight"].getCountdown())&&i.isPaused()?"pause":"resume";break}this[" log"].push([Date.now()].concat(n,t))}};t.prototype.registerEventListeners=function(){this[" fight"].getWhiteOpponent().on("add",e.bind(this,"white","add")).on("remove",e.bind(this,"white","remove"));this[" fight"].getRedOpponent().on("add",e.bind(this,"red","add")).on("remove",e.bind(this,"red","remove"))};function e(e,t,i){this[" log"].push([Date.now(),e,t,i])}return{create:function(e){return new t(e)}}});!function(e,t){if("function"==typeof define&&define.amd)define("direzione-lib/model/Fight",["durata/dist/durata.min","direzione-lib/model/FightHistory"],t);else if("object"==typeof module&&module.exports)module.exports=t(require("durata"),require("./FightHistory"));else{e.Direzione=e.Direzione||{};e.Direzione.Fight=t(e.Durata,e.Direzione.FightHistory)}}(this,function(s,o){function r(e,t,i,n){this[" settings"]=e;this[" whiteOpponent"]=t;this[" redOpponent"]=i;this[" history"]=(void 0===n||!n)&&o.create(this);this[" stopped"]=!1;this[" listener"]={reset:[],startPauseResume:[],osaeKomi:[],stop:[],toketa:[],removeCountUp:[],timeUp:[]}}r.DURATION=18e4;r.COUNTUP=1e4;r.LOCK_OUT=6e5;r.SIDE_WHITE="white";r.SIDE_RED="red";r.SIDE_CENTER="center";r.prototype={clearListeners:function(e){e=void 0===e||e;Object.keys(this[" listener"]).forEach(function(e){delete this[" listener"][e];this[" listener"][e]=[]},this);this.getRedOpponent().clearListeners();this.getWhiteOpponent().clearListeners();e&&this.getHistory()&&this.getHistory().registerEventListeners()},getHistory:function(){return this[" history"]},getCountdown:function(){return i.call(this)&&this[" countdown"]},getCountUp:function(){return h.call(this)&&this[" countup"]},getWhiteOpponent:function(){return this[" whiteOpponent"]},getRedOpponent:function(){return this[" redOpponent"]},getTimeLeft:function(){return i.call(this)?this[" countdown"].get():this[" settings"].getDuration()},isRunning:function(){return!this[" stopped"]&&i.call(this)&&!this[" countdown"].isPaused()&&!this[" countdown"].isComplete()},isStopped:function(){return this[" stopped"]},invertSide:c,on:function(e,t){var i=Object.keys(this[" listener"]);if(-1===i.indexOf(e))throw new RangeError("Only following values are allowed for event type: "+i.join(", ")+"!");this[" listener"][e].push(t);return this},removeCountUp:n,reset:function(e){this[" stopped"]=!1;n.call(this);i.call(this)&&this[" countdown"].stop("interrupt");u.call(this,e);this[" countdown"].pause("reset");this[" whiteOpponent"].reset();this[" redOpponent"].reset();void 0===e&&d.call(this,"reset",i.call(this)?this[" countdown"].get():void 0)},startPauseResume:function(e){if(!this.isStopped()){if(i.call(this)){if(this[" countdown"].isComplete())return;if(void 0!==e){var t=this[" countdown"].isPaused();u.call(this,e);t&&this[" countdown"].pause("renew")}!function(){this.isStopped()||this[" countdown"].isPaused()&&this[" countdown"].resume("toggle")||this[" countdown"].pause("toggle")}.call(this)}else u.call(this,e);void 0===e&&d.call(this,"startPauseResume",this[" countdown"].get())}},osaeKomi:function(e,t){if(void 0!==t||!this.isStopped()&&i.call(this)&&!this[" countdown"].isPaused()){e=e||r.SIDE_CENTER;e=this[" settings"].isGripSideInverted()?c(e):e;!h.call(this)||this[" countup"].isPaused()||void 0!==t?l.call(this,e,t):this[" countup"].side=e;void 0===t&&d.call(this,"osaeKomi",this[" settings"].isGripSideInverted()?c(e):e)}},stop:function(e,t,i){this[" stopped"]=!0;if(void 0===e)this[" countdown"].stop("timeup");else{u.call(this,e);this[" countdown"].stop("timeup");l.call(this,i,t)}h.call(this)&&this[" countup"].stop("timeup");if(void 0===e){this[" whiteOpponent"].getPerson().setLockOut(this[" settings"].getLockOutTime());this[" redOpponent"].getPerson().setLockOut(this[" settings"].getLockOutTime());d.call(this,"stop",[this[" countdown"].get(),h.call(this)?this[" countup"].get():0,h.call(this)?this[" countup"].side:r.SIDE_CENTER])}},toketa:a};function i(){return void 0!==this[" countdown"]}function h(){return void 0!==this[" countup"]}function n(){if(h.call(this)){this[" countup"].stop("reset");delete this[" countup"];d.call(this,"removeCountUp")}}function u(e){var t=void 0!==e?e:this[" settings"].getDuration();i.call(this)&&this[" countdown"].stop("dirty");this[" countdown"]=s.create(t,0,t).on("resume",n.bind(this)).on("pause",function(e){"osaekomi-timeup"===e&&d.call(this,"timeUp")}.bind(this));void 0===e&&this[" countdown"].on("complete",d.bind(this,"timeUp")).on("pause",a.bind(this,void 0))}function c(e){return e===r.SIDE_CENTER?r.SIDE_CENTER:e===r.SIDE_RED?r.SIDE_WHITE:r.SIDE_RED}function l(e,t){var i=t||0,n=this[" settings"].getCountUpLimit(),o=void 0!==t?this[" settings"].getCountUpLimitIppon():n;h.call(this)&&this[" countup"].stop("dirty");this[" countup"]=s.create(i,o,o-i);this[" countup"].side=e;void 0===t&&this[" countup"].on("pause",function(){d.call(this,"toketa",this[" countup"].get())}.bind(this)).on("complete",function(){if(0!==this[" "+this[" countup"].side+"Opponent"].getScore())this[" countdown"].isPaused()||this[" countdown"].pause("osaekomi-timeup");else{this[" countup"].stop("replace");l.call(this,this[" countup"].side,n);this[" countup"].on("pause",function(){d.call(this,"toketa",this[" countup"].get())}.bind(this)).on("complete",function(){this[" countdown"].isPaused()||this[" countdown"].pause("osaekomi-timeup")}.bind(this))}}.bind(this))}function a(e){void 0!==e&&l.call(this,this[" countup"].side,e);h.call(this)&&this[" countup"].pause("toketa")}function d(e,t){this[" history"]&&this[" history"].insert(e,t);this[" listener"][e].forEach(function(e){e.call(this,t)},this)}return{create:function(e,t,i,n){return new r(e,t,i,n)},DURATION:r.DURATION,COUNTUP:r.COUNTUP,LOCK_OUT:r.LOCK_OUT,SIDE_WHITE:r.SIDE_WHITE,SIDE_RED:r.SIDE_RED,SIDE_CENTER:r.SIDE_CENTER}});!function(e,t){if("function"==typeof define&&define.amd)define("direzione-lib/config/FightSettings",["direzione-lib/model/Fight"],t);else if("object"==typeof module&&module.exports)module.exports=t(require("../model/Fight"));else{e.Direzione=e.Direzione||{};e.Direzione.FightSettings=t(e.Direzione.Fight)}}(this,function(e){var t=["duration","countUpLimit","countUpLimitIppon","personLockOut","timeUpSoundFile"];function i(){this.duration=e.DURATION;this.countUpLimit=e.COUNTUP;this.countUpLimitIppon=2*e.COUNTUP;this.personLockOut=e.LOCK_OUT;this.invertGripDisplay=!1;this.invertGripSide=!1;this.timeUpSoundFile="";this.fromStorage();this.fromURLParameters()}i.prototype={toStorage:function(){localStorage.setItem("Direzione.FightSettings",JSON.stringify(this))},fromStorage:function(){var t,e=localStorage.getItem("Direzione.FightSettings");if(e){t=JSON.parse(e);Object.keys(t).forEach(function(e){this[e]=t[e]},this)}},fromURLParameters:function(){var e=new URLSearchParams(window.location.search);Array.from(e.entries()).forEach(function(e){t.includes(e[0])&&(this[e[0]]=e[1])},this)},getDuration:function(){return this.duration},getCountUpLimit:function(){return this.countUpLimit},getCountUpLimitIppon:function(){return this.countUpLimitIppon},getLockOutTime:function(){return this.personLockOut},isGripDisplayInverted:function(){return this.invertGripDisplay},isGripSideInverted:function(){return this.invertGripSide},getTimeUpSoundFile:function(){return this.timeUpSoundFile},setDuration:function(e){if(!Number.isInteger(e))throw TypeError("Duration has to be of type integer");this.duration=e;return this},setCountUpLimit:function(e){if(!Number.isInteger(e))throw TypeError("Limit for count up (wazari) has to be of type integer");this.countUpLimit=e;return this},setCountUpLimitIppon:function(e){if(!Number.isInteger(e))throw TypeError("Limit for count up (ippon) has to be of type integer");this.countUpLimitIppon=e;return this},setLockOutTime:function(e){if(!Number.isInteger(e))throw TypeError("The lock-out time has to be of type integer");this.personLockOut=e;return this},setGripDisplayInverted:function(e){this.invertGripDisplay=!!e;return this},setGripSideInverted:function(e){this.invertGripSide=!!e;return this},setTimeUpSoundFile:function(e){this.timeUpSoundFile=e;return this}};return{create:function(){return new i}}});!function(e,t){if("function"==typeof define&&define.amd)define("direzione-lib/model/Opponent",t);else if("object"==typeof module&&module.exports)module.exports=t();else{e.Direzione=e.Direzione||{};e.Direzione.Opponent=t()}}(this,function(){function n(e,t,i){this[" person"]=e;this[" score"]=t||0;this[" penalty"]=i||0;this[" listener"]={add:[],remove:[],reset:[]}}n.SCORE_WAZARI=4;n.MAX_SCORE=n.SCORE_IPPON=8;n.MAX_PENALTY=3*(n.PENALTY_SHIDO=1);n.prototype={clearListeners:function(){Object.keys(this[" listener"]).forEach(function(e){delete this[" listener"][e];this[" listener"][e]=[]},this)},addIppon:function(){if(!(this[" score"]>=n.MAX_SCORE)){e.call(this,"add","Ippon");this[" score"]=n.SCORE_IPPON}},addShido:function(){if(!(this[" penalty"]>=n.MAX_PENALTY)){e.call(this,"add","Shido");this[" penalty"]=this[" penalty"]+n.PENALTY_SHIDO}},addWazari:function(){if(!(this[" score"]>=n.MAX_SCORE)){e.call(this,"add","Wazari");this[" score"]=this[" score"]+n.SCORE_WAZARI}},getPerson:function(){return this[" person"]},getFullName:function(){return this.getPerson().getFirstName()+" "+this.getPerson().getLastName()},getScore:function(){return this[" score"]>=n.MAX_SCORE?n.MAX_SCORE:this[" score"]},getShido:function(){return this[" penalty"]>=n.MAX_PENALTY?n.MAX_PENALTY:this[" penalty"]},on:function(e,t){var i=Object.keys(this[" listener"]);if(-1===i.indexOf(e))throw new RangeError("Only following values are allowed for event type: "+i.join(", ")+"!");this[" listener"][e].push(t);return this},removeIppon:function(){if(!(this[" score"]-n.SCORE_IPPON<0)){e.call(this,"remove","Ippon");this[" score"]=this[" score"]-n.SCORE_IPPON}},removeShido:function(){if(!(this[" penalty"]<=0)){e.call(this,"remove","Shido");this[" penalty"]=this[" penalty"]-n.PENALTY_SHIDO}},removeWazari:function(){if(!(this[" score"]<=0)){e.call(this,"remove","Wazari");this[" score"]=this[" score"]-n.SCORE_WAZARI}},reset:function(){e.call(this,"reset");this[" score"]=0;this[" penalty"]=0;this.getPerson().reset()}};function e(e,t){this[" listener"][e].forEach(function(e){e.call(this,t)},this)}return{create:function(e,t,i){return new n(e,t,i)}}});!function(e,t){if("function"==typeof define&&define.amd)define("direzione-lib/model/Person",["durata/dist/durata.min"],t);else if("object"==typeof module&&module.exports)module.exports=t(require("durata"));else{e.Direzione=e.Direzione||{};e.Direzione.Person=t(e.Durata)}}(this,function(t){function n(e,t,i){this[" firstName"]=e;this[" lastName"]=t;this[" club"]=i}n.prototype={getClubName:function(){return this[" club"]},getFirstName:function(){return this[" firstName"]},getLastName:function(){return this[" lastName"]},setLockOut:function(e){this.reset();this[" lockout"]=t.create(e,0,e)},getLockOut:function(){return void 0!==this[" lockout"]&&this[" lockout"]},reset:function(){void 0!==this[" lockout"]&&this[" lockout"].stop();delete this[" lockout"]}};return{create:function(e,t,i){return new n(e,t,i)},isInstance:function(e){return e instanceof n}}});!function(e,t){if("function"==typeof define&&define.amd)define("direzione-lib/model/OpponentGroup",["direzione-lib/model/Person"],t);else if("object"==typeof module&&module.exports)module.exports=t(require("./Person"));else{e.Direzione=e.Direzione||{};e.Direzione.OpponentGroup=t(e.Direzione.Person)}}(this,function(t){function i(e){this[" name"]=e;this[" persons"]=[];this[" listener"]={add:[],remove:[]}}i.prototype={addPerson:function(e){if(t.isInstance(e)){n.call(this,"add",e);this[" persons"].push(e)}},removePerson:function(t){var e=this[" persons"].length;this[" persons"]=this[" persons"].filter(function(e){return e!==t});e!==this[" persons"].length&&n.call(this,"remove",t)},getPersons:function(){return this[" persons"].slice()},on:function(e,t){var i=Object.keys(this[" listener"]);if(-1===i.indexOf(e))throw new RangeError("Only following values are allowed for event type: "+i.join(", ")+"!");this[" listener"][e].push(t);return this},getName:function(){return this[" name"]}};function n(e,t){this[" listener"][e].forEach(function(e){e.call(this,t)},this)}return{create:function(e){return new i(e)}}});!function(e,t){if("function"==typeof define&&define.amd)define("direzione-lib/model/Playlist",t);else if("object"==typeof module&&module.exports)module.exports=t();else{e.Direzione=e.Direzione||{};e.Direzione.Playlist=t()}}(this,function(){function e(){this[" cursor"]=void 0;this[" head"]=void 0;this[" tail"]=void 0;this[" length"]=0;this[" eof"]=!1}e.prototype={empty:function(){var e;r.call(this);for(;e=s.call(this);)o.call(this,e);return r.call(this)},find:i,insert:function(e){e=new t(this,e);if(this[" length"])if(void 0===this[" cursor"]){(this[" head"][" prev"]=e)[" next"]=this[" head"];this[" head"]=e}else{void 0===this[" cursor"][" next"]?this[" tail"]=e:this[" cursor"][" next"][" prev"]=e;e[" next"]=this[" cursor"][" next"];(this[" cursor"][" next"]=e)[" prev"]=this[" cursor"];this[" cursor"]=e}else{this[" head"]=e;this[" tail"]=e;this[" cursor"]=e}this[" length"]++;this[" eof"]=!1;return this[" length"]},includes:n,next:s,prev:function(){var e;if(this[" eof"]){this[" eof"]=!1;e=this[" cursor"]=this[" tail"]}else{e=this[" cursor"]&&this[" cursor"][" prev"];this[" cursor"]=e}return e&&e[" value"]},reset:r,remove:o,getLength:function(){return this[" length"]}};function t(e,t){this[" list"]=e;this[" value"]=t;this[" prev"]=void 0;this[" next"]=void 0}function i(e,t){if("function"!=typeof e)throw new TypeError("You must provide a function as first argument");if(this[" length"]){(t=t||0)<0&&(t=this[" length"]+t);for(var i=this[" head"],n=0;n<this[" length"];n++){if(t<=n&&e(i[" value"],n)){this[" cursor"]=i;this[" eof"]=!1;return i[" value"]}i=i[" next"]}this[" cursor"]=void 0}}function n(t,e){i.call(this,function(e){return Object.is(e,t)},e);return!!this[" cursor"]}function o(e,t){if(n.call(this,e,t)){e=this[" cursor"];!function(){if(this[" list"]){this[" prev"]&&(this[" prev"][" next"]=this[" next"]);this[" next"]&&(this[" next"][" prev"]=this[" prev"]);this===this[" list"][" cursor"]&&(this[" list"][" cursor"]=this[" next"]||this[" prev"]);this===this[" list"][" head"]&&(this[" list"][" head"]=this[" next"]);this===this[" list"][" tail"]&&(this[" list"][" tail"]=this[" prev"]);this[" list"][" length"]--;this[" prev"]=void 0;this[" next"]=void 0;this[" list"]=void 0}}.call(e);r.call(this);return e[" value"]}}function s(){var e;if(this[" cursor"]!==this[" tail"])return e=this[" cursor"]?this[" cursor"][" next"]:this[" head"],(this[" cursor"]=e)&&e[" value"];this[" eof"]=!0}function r(){this[" cursor"]=void 0;this[" eof"]=!1;return this}return{create:function(){return new e}}});!function(e,t){if("function"==typeof define&&define.amd)define("direzione-lib/util/Utils",t);else if("object"==typeof module&&module.exports)module.exports=t();else{e.Direzione=e.Direzione||{};e.Direzione.Utils=t()}}(this,function(){return{loadTranslationJS:function(e,t){var i=document.createElement("script");i.onload=function(){t(Direzione.translation)};i.src=e;document.head.appendChild(i)},getMinSecDisplay:function(e){e=Math.ceil(e/1e3);return Math.floor(e/60)+":"+(e%60+"").padStart(2,"0")}}});!function(e,t){if("function"==typeof define&&define.amd)define("direzione-lib/view/Scoreboard",["direzione-lib/model/Fight","direzione-lib/util/Utils"],t);else if("object"==typeof module&&module.exports)module.exports=t(require("../model/Fight"),require("../util/Utils"));else{e.Direzione=e.Direzione||{};e.Direzione.Scoreboard=t(e.Direzione.Fight,e.Direzione.Utils)}}(this,function(i,n){function o(e,t){this[" fight"]=e;this[" outputElems"]={countdown:t.outputElemCountdown,clockSec:t.outputElemStopwatchSeconds,clockMSec:t.outputElemStopwatchMilliseconds,whiteScore:t.outputElemWhiteScore,redScore:t.outputElemRedScore,whiteShido:t.outputElemWhiteShido,redShido:t.outputElemRedShido,whiteOpponent:t.outputElemWhiteOpponent,redOpponent:t.outputElemRedOpponent,whiteClub:t.outputElemWhiteClub,redClub:t.outputElemRedClub};this[" initValMemCountdown"]=t.outputElemCountdown.innerText;this.showNames();this.run()}o.prototype={replaceFight:function(e){this.stop();this[" fight"]=e;this.showNames();this.run()},run:function(){this[" allowRun"]=!0;requestAnimationFrame(this[" animationLoop"]=function(){!function(){this[" outputElems"].countdown.innerText=n.getMinSecDisplay(this[" fight"].getTimeLeft());var e=this[" fight"].getCountUp();if(e){var t=e.get();this[" outputElems"].clockSec.innerText=r(t);this[" outputElems"].clockMSec.innerText=s(t);this[" outputElems"].clockSec.parentNode.className=this[" fight"][" settings"].isGripDisplayInverted()?this[" fight"].invertSide(e.side):e.side}else{this[" outputElems"].clockSec.innerText=r(0);this[" outputElems"].clockMSec.innerText=s(0);this[" outputElems"].clockSec.parentNode.className=i.SIDE_CENTER}this[" outputElems"].whiteScore.innerText=this[" fight"].getWhiteOpponent().getScore();this[" outputElems"].redScore.innerText=this[" fight"].getRedOpponent().getScore();this[" outputElems"].whiteShido.innerText=this[" fight"].getWhiteOpponent().getShido();this[" outputElems"].redShido.innerText=this[" fight"].getRedOpponent().getShido()}.call(this);this[" allowRun"]?requestAnimationFrame(this[" animationLoop"]):this[" allowRun"]=!0}.bind(this))},stop:function(){this[" allowRun"]=!1},showNames:function(){this[" outputElems"].whiteOpponent.innerText=this[" fight"].getWhiteOpponent().getFullName();this[" outputElems"].redOpponent.innerText=this[" fight"].getRedOpponent().getFullName();this[" outputElems"].whiteClub.innerText=this[" fight"].getWhiteOpponent().getPerson().getClubName();this[" outputElems"].redClub.innerText=this[" fight"].getRedOpponent().getPerson().getClubName()},hideNames:function(){this[" outputElems"].whiteOpponent.innerText="";this[" outputElems"].redOpponent.innerText="";this[" outputElems"].whiteClub.innerText="";this[" outputElems"].redClub.innerText=""},shutdown:function(){this.stop();this.hideNames();requestAnimationFrame(function(){this[" outputElems"].countdown.innerText=this[" initValMemCountdown"];this[" outputElems"].clockSec.innerText=r(0);this[" outputElems"].clockMSec.innerText=s(0);this[" outputElems"].clockSec.parentNode.className=i.SIDE_CENTER;this[" outputElems"].whiteScore.innerText=0;this[" outputElems"].redScore.innerText=0;this[" outputElems"].whiteShido.innerText=0;this[" outputElems"].redShido.innerText=0}.bind(this))}};function s(e){return(Math.floor(e%1e3)+"").padStart(3,"0")}function r(e){return Math.floor(e/1e3)%60}return{create:function(e,t){return new o(e,t)}}});!function(e,t){if("function"==typeof define&&define.amd)define("direzione-lib/service/FightEmitter",["peerjs/dist/peerjs.min"],t);else if("object"==typeof module&&module.exports)module.exports=t(require("peerjs"));else{e.Direzione=e.Direzione||{};e.Direzione.FightEmitter=t(e.peerjs)}}(this,function(n){function i(e,t,i){i=(i=i||[]).length<1?{}:{config:{iceServers:i}};this[" localPeer"]=new n.Peer(i);this[" fight"]=t;this[" receiverID"]=e;this[" connected"]=!1;this[" conn"]=!1;this[" listener"]={disconnect:[],establish:[]};s.call(this)}i.prototype={connect:function(){var i={resolve:null,reject:null};i.promise=new Promise(function(e,t){i.resolve=e;i.reject=t});this[" conn"]=this[" localPeer"].connect(this[" receiverID"]);this[" conn"].on("open",function(){this[" connected"]=!0;!function(){var e;function t(e,t){return["new",e,t.getPerson().getFirstName(),t.getPerson().getLastName(),t.getPerson().getClubName(),t.getScore(),t.getShido()]}o.call(this,t("white",this[" fight"].getWhiteOpponent()));o.call(this,t("red",this[" fight"].getRedOpponent()));o.call(this,["new","fight",this[" fight"].getTimeLeft(),this[" fight"][" settings"].getCountUpLimit(),this[" fight"][" settings"].getCountUpLimitIppon(),this[" fight"][" settings"].isGripDisplayInverted(),this[" fight"][" settings"].isGripSideInverted()]);this[" fight"].isRunning()&&o.call(this,["fight","startPauseResume",this[" fight"].getTimeLeft()]);if(e=this[" fight"].getCountUp()){var i=e.isComplete()?4:e.isStopped()?3:e.isPaused()?2:1,n=this[" fight"][" settings"].isGripSideInverted()?this[" fight"].invertSide(e.side):e.side;o.call(this,["new","countup",n,e.get(),i])}}.call(this);e.call(this,"establish","peer opened");i.resolve()}.bind(this));this[" conn"].on("close",function(){this[" connected"]=!1;e.call(this,"disconnect","peer closed")}.bind(this));return i.promise},disconnect:function(){return this[" connected"]&&this[" conn"].close()||!0},isConnected:function(){return this[" connected"]},on:function(e,t){var i=Object.keys(this[" listener"]);if(-1===i.indexOf(e))throw new RangeError("Only following values are allowed for event type: "+i.join(", ")+"!");this[" listener"][e].push(t);return this},getFight:function(){return this[" fight"]},replaceFight:function(e){this.disconnect();this[" fight"].clearListeners();delete this[" fight"];this[" fight"]=e;s.call(this)}};function o(e){this.isConnected()&&this[" conn"].send(e)}function s(){var e=this[" fight"].getRedOpponent(),t=this[" fight"].getWhiteOpponent();this[" fight"].on("reset",function(e){o.call(this,["fight","reset",e])}.bind(this));this[" fight"].on("startPauseResume",function(e){o.call(this,["fight","startPauseResume",e])}.bind(this));this[" fight"].on("stop",function(e){o.call(this,["fight","stop",e[0],e[1],e[2]])}.bind(this));this[" fight"].on("toketa",function(e){o.call(this,["fight","toketa",e])}.bind(this));this[" fight"].on("osaeKomi",function(e){o.call(this,["fight","osaeKomi",e])}.bind(this));this[" fight"].on("removeCountUp",function(){o.call(this,["fight","removeCountUp"])}.bind(this));e.on("add",function(e){o.call(this,["red","add"+e])}.bind(this)).on("remove",function(e){o.call(this,["red","remove"+e])}.bind(this));t.on("add",function(e){o.call(this,["white","add"+e])}.bind(this)).on("remove",function(e){o.call(this,["white","remove"+e])}.bind(this))}function e(e,t){this[" listener"][e].forEach(function(e){e.call(this,t)},this)}return{create:function(e,t){return new i(e,t)}}});!function(e,t){if("function"==typeof define&&define.amd)define("direzione-lib/service/FightReceiver",["peerjs/dist/peerjs.min","direzione-lib/model/Fight","direzione-lib/config/FightSettings","direzione-lib/model/Opponent","direzione-lib/model/Person","direzione-lib/view/Scoreboard"],t);else if("object"==typeof module&&module.exports)module.exports=t(require("peerjs"),require("../model/Fight"),require("../config/FightSettings"),require("../model/Opponent"),require("../model/Person"),require("../view/Scoreboard"));else{e.Direzione=e.Direzione||{};e.Direzione.FightReceiver=t(e.peerjs,e.Direzione.Fight,e.Direzione.FightSettings,e.Direzione.Opponent,e.Direzione.Person,e.Direzione.Scoreboard)}}(this,function(n,o,s,r,h,u){function i(e,t,i){i=(i=i||[]).length<1?{}:{config:{iceServers:i}};this[" localPeer"]=new n.Peer(e,i);this[" receiverID"]=e;this[" connected"]=!1;this[" conn"]=!1;this[" viewConfig"]=t;this[" listener"]={disconnect:[],establish:[]};this[" redOpponent"]=null;this[" whiteOpponent"]=null;this[" fight"]=null;this[" board"]=null;this[" initValMemCountdown"]=t.outputElemCountdown.innerText;!function(){this[" localPeer"].on("connection",function(e){(this[" conn"]=e).on("open",function(){this[" connected"]=!0;c.call(this,"establish","peer opened");e.on("data",function(e){if("new"===e[0])switch(e[1]){case"red":return this[" redOpponent"]=r.create(h.create(e[2],e[3],e[4]),e[5],e[6]);case"white":return this[" whiteOpponent"]=r.create(h.create(e[2],e[3],e[4]),e[5],e[6]);case"fight":var t=s.create();t.setDuration(e[2]).setCountUpLimit(e[3]).setCountUpLimitIppon(e[4]).setGripDisplayInverted(e[5]).setGripSideInverted(e[6]);this[" viewConfig"].outputElemCountdown.innerText=this[" initValMemCountdown"];this[" fight"]=o.create(t,this[" whiteOpponent"],this[" redOpponent"],!0);this[" board"]=u.create(this[" fight"],this[" viewConfig"]);return;case"countup":this[" fight"].osaeKomi(e[2],e[3]);return-1!==[4,3,2].indexOf(e[4])?this[" fight"].toketa(e[3]):void 0}switch(e[0]){case"fight":return this[" fight"][e[1]](3<=e.length?e[2]:void 0,4<=e.length?e[3]:void 0,5<=e.length?e[4]:void 0);case"red":return this[" redOpponent"][e[1]]();case"white":return this[" whiteOpponent"][e[1]]()}}.bind(this))}.bind(this));e.on("close",function(){this[" connected"]=!1;this[" board"].shutdown();c.call(this,"disconnect","peer closed")}.bind(this))}.bind(this))}.call(this)}i.prototype={isConnected:function(){return this[" connected"]},on:function(e,t){var i=Object.keys(this[" listener"]);if(-1===i.indexOf(e))throw new RangeError("Only following values are allowed for event type: "+i.join(", ")+"!");this[" listener"][e].push(t);return this}};function c(e,t){this[" listener"][e].forEach(function(e){e.call(this,t)},this)}return{create:function(e,t){return new i(e,t)}}});!function(e,t){if("function"==typeof define&&define.amd)define("direzione-lib/service/LocalBroker",t);else if("object"==typeof module&&module.exports)module.exports=t();else{e.Direzione=e.Direzione||{};e.Direzione.LocalBroker=t()}}(this,function(){function t(e){this[" localPeer"]=e;localStorage.a=localStorage.b=JSON.stringify([]);this[" idx"]=0;this[" intv"]=setInterval(function(){if(!this[" in"]){if(!JSON.parse(localStorage.a).length)return;this[" in"]="a";this[" out"]="b"}var e=JSON.parse(localStorage[this[" in"]]);if(!(e.length<=this[" idx"])){this.onmessage&&this.onmessage({data:e[this[" idx"]]});this[" idx"]++}}.bind(this),20);setTimeout(function(){this.onopen&&this.onopen({})}.bind(this))}t.prototype={send:function(e){if(!this[" out"]){this[" out"]="a";this[" in"]="b"}var t=JSON.parse(localStorage[this[" out"]]);t.push(e);localStorage[this[" out"]]=JSON.stringify(t)},onmessage:function(e){e=e.data;e.sdp&&this[" localPeer"].setRemoteDescription(new RTCSessionDescription(e.sdp)).then(function(){"stable"!=this[" localPeer"].signalingState&&this[" localPeer"].createAnswer().then(function(e){return this[" localPeer"].setLocalDescription(e)}.bind(this)).then(function(){this.send({sdp:this[" localPeer"].localDescription})}.bind(this))}.bind(this))||e.candidate&&this[" localPeer"].addIceCandidate(new RTCIceCandidate(e.candidate))},close:function(){clearInterval(this[" intv"]);localStorage.a=localStorage.b=JSON.stringify([])}};return{create:function(e){return new t(e)}}});!function(e,t){if("function"==typeof define&&define.amd)define("direzione-lib/service/FightEmitterLocal",["direzione-lib/service/LocalBroker"],t);else if("object"==typeof module&&module.exports)module.exports=t(require("./LocalBroker"));else{e.Direzione=e.Direzione||{};e.Direzione.FightEmitterLocal=t(e.Direzione.LocalBroker)}}(this,function(i){function n(e,t){this[" localPeer"]=new RTCPeerConnection;this[" fight"]=t;this[" receiverID"]=e;this[" connected"]=!1;this[" conn"]=!1;this[" listener"]={disconnect:[],establish:[]};!function(){var t=i.create(this[" localPeer"]);this[" broker"]=t;this[" localPeer"].onicecandidate=function(e){t.send({candidate:e.candidate})};this[" localPeer"].onnegotiationneeded=function(){this[" localPeer"].createOffer().then(function(e){return this[" localPeer"].setLocalDescription(e)}.bind(this)).then(function(){t.send({sdp:this[" localPeer"].localDescription})}.bind(this))}.bind(this)}.call(this);s.call(this)}n.prototype={connect:function(){var i={resolve:null,reject:null};i.promise=new Promise(function(e,t){i.resolve=e;i.reject=t});this[" conn"]=this[" localPeer"].createDataChannel(this[" receiverID"]);this[" conn"].onopen=function(){this[" connected"]=!0;!function(){var e;function t(e,t){return["new",e,t.getPerson().getFirstName(),t.getPerson().getLastName(),t.getPerson().getClubName(),t.getScore(),t.getShido()]}o.call(this,t("white",this[" fight"].getWhiteOpponent()));o.call(this,t("red",this[" fight"].getRedOpponent()));o.call(this,["new","fight",this[" fight"].getTimeLeft(),this[" fight"][" settings"].getCountUpLimit(),this[" fight"][" settings"].getCountUpLimitIppon(),this[" fight"][" settings"].isGripDisplayInverted(),this[" fight"][" settings"].isGripSideInverted()]);this[" fight"].isRunning()&&o.call(this,["fight","startPauseResume",this[" fight"].getTimeLeft()]);if(e=this[" fight"].getCountUp()){var i=e.isComplete()?4:e.isStopped()?3:e.isPaused()?2:1,n=this[" fight"][" settings"].isGripSideInverted()?this[" fight"].invertSide(e.side):e.side;o.call(this,["new","countup",n,e.get(),i])}}.call(this);this[" broker"].close();e.call(this,"establish","peer opened");i.resolve()}.bind(this);this[" conn"].onclose=function(){this[" connected"]=!1;e.call(this,"disconnect","peer closed")}.bind(this);return i.promise},disconnect:function(){return this[" connected"]&&this[" conn"].close()||!0},isConnected:function(){return this[" connected"]},on:function(e,t){var i=Object.keys(this[" listener"]);if(-1===i.indexOf(e))throw new RangeError("Only following values are allowed for event type: "+i.join(", ")+"!");this[" listener"][e].push(t);return this},getFight:function(){return this[" fight"]},replaceFight:function(e){this.disconnect();this[" fight"].clearListeners();delete this[" fight"];this[" fight"]=e;s.call(this)}};function o(e){this.isConnected()&&this[" conn"].send(JSON.stringify(e))}function s(){var e=this[" fight"].getRedOpponent(),t=this[" fight"].getWhiteOpponent();this[" fight"].on("reset",function(e){o.call(this,["fight","reset",e])}.bind(this));this[" fight"].on("startPauseResume",function(e){o.call(this,["fight","startPauseResume",e])}.bind(this));this[" fight"].on("stop",function(e){o.call(this,["fight","stop",e[0],e[1],e[2]])}.bind(this));this[" fight"].on("toketa",function(e){o.call(this,["fight","toketa",e])}.bind(this));this[" fight"].on("osaeKomi",function(e){o.call(this,["fight","osaeKomi",e])}.bind(this));this[" fight"].on("removeCountUp",function(){o.call(this,["fight","removeCountUp"])}.bind(this));e.on("add",function(e){o.call(this,["red","add"+e])}.bind(this)).on("remove",function(e){o.call(this,["red","remove"+e])}.bind(this));t.on("add",function(e){o.call(this,["white","add"+e])}.bind(this)).on("remove",function(e){o.call(this,["white","remove"+e])}.bind(this))}function e(e,t){this[" listener"][e].forEach(function(e){e.call(this,t)},this)}return{create:function(e,t){return new n(e,t)}}});!function(e,t){if("function"==typeof define&&define.amd)define("direzione-lib/service/FightReceiverLocal",["direzione-lib/service/LocalBroker","direzione-lib/model/Fight","direzione-lib/config/FightSettings","direzione-lib/model/Opponent","direzione-lib/model/Person","direzione-lib/view/Scoreboard"],t);else if("object"==typeof module&&module.exports)module.exports=t(require("./LocalBroker"),require("../model/Fight"),require("../config/FightSettings"),require("../model/Opponent"),require("../model/Person"),require("../view/Scoreboard"));else{e.Direzione=e.Direzione||{};e.Direzione.FightReceiverLocal=t(e.Direzione.LocalBroker,e.Direzione.Fight,e.Direzione.FightSettings,e.Direzione.Opponent,e.Direzione.Person,e.Direzione.Scoreboard)}}(this,function(i,n,o,s,r,h){function u(e,t){this[" localPeer"]=new RTCPeerConnection;this[" receiverID"]=e;this[" connected"]=!1;this[" conn"]=!1;this[" viewConfig"]=t;this[" listener"]={disconnect:[],establish:[]};this[" redOpponent"]=null;this[" whiteOpponent"]=null;this[" fight"]=null;this[" board"]=null;this[" initValMemCountdown"]=t.outputElemCountdown.innerText;!function(){var t=i.create(this[" localPeer"]);this[" broker"]=t;this[" localPeer"].onicecandidate=function(e){t.send({candidate:e.candidate})};this[" localPeer"].onnegotiationneeded=function(){this[" localPeer"].createOffer().then(function(e){return this[" localPeer"].setLocalDescription(e)}.bind(this)).then(function(){t.send({sdp:this[" localPeer"].localDescription})}.bind(this))}.bind(this)}.call(this);!function(){this[" localPeer"].ondatachannel=function(e){this[" conn"]=e.channel;this[" conn"].onmessage=function(e){!function(e){if("new"===e[0])switch(e[1]){case"red":return this[" redOpponent"]=s.create(r.create(e[2],e[3],e[4]),e[5],e[6]);case"white":return this[" whiteOpponent"]=s.create(r.create(e[2],e[3],e[4]),e[5],e[6]);case"fight":var t=o.create();t.setDuration(e[2]).setCountUpLimit(e[3]).setCountUpLimitIppon(e[4]).setGripDisplayInverted(e[5]).setGripSideInverted(e[6]);this[" viewConfig"].outputElemCountdown.innerText=this[" initValMemCountdown"];this[" fight"]=n.create(t,this[" whiteOpponent"],this[" redOpponent"],!0);this[" board"]=h.create(this[" fight"],this[" viewConfig"]);return;case"countup":this[" fight"].osaeKomi(e[2],e[3]);return-1!==[4,3,2].indexOf(e[4])?this[" fight"].toketa(e[3]):void 0}switch(e[0]){case"fight":return this[" fight"][e[1]](3<=e.length?e[2]:void 0,4<=e.length?e[3]:void 0,5<=e.length?e[4]:void 0);case"red":return this[" redOpponent"][e[1]]();case"white":return this[" whiteOpponent"][e[1]]()}}.call(this,JSON.parse(e.data))}.bind(this);this[" conn"].onopen=function(){this[" connected"]=!0;this[" broker"].close();c.call(this,"establish","peer opened")}.bind(this);this[" conn"].onclose=function(){this[" connected"]=!1;this[" board"].shutdown();c.call(this,"disconnect","peer closed")}.bind(this)}.bind(this)}.call(this)}u.prototype={isConnected:function(){return this[" connected"]},on:function(e,t){var i=Object.keys(this[" listener"]);if(-1===i.indexOf(e))throw new RangeError("Only following values are allowed for event type: "+i.join(", ")+"!");this[" listener"][e].push(t);return this}};function c(e,t){this[" listener"][e].forEach(function(e){e.call(this,t)},this)}return{create:function(e,t){return new u(e,t)}}});!function(e,t){if("function"==typeof define&&define.amd)define("direzione-lib/view/Repertoire",["direzione-lib/util/Utils"],t);else if("object"==typeof module&&module.exports)module.exports=t(require("../util/Utils"));else{e.Direzione=e.Direzione||{};e.Direzione.Repertoire=t(e.Direzione.Utils)}}(this,function(o){function i(e,t){this[" tournament"]=e;this[" entryJig"]=t.entryJigElem.cloneNode(!0);this[" entryWrapper"]=t.entryWrapperElem;this[" cssWhiteName"]=t.selectorWhiteOpponentName||".white";this[" cssRedName"]=t.selectorRedOpponentName||".red";this[" cssWhiteLockOut"]=t.selectorWhiteOpponentLockOut;this[" cssRedLockOut"]=t.selectorRedOpponentLockOut;t.entryJigElem.remove();this[" entryJig"].removeAttribute("id");s.call(this);n.call(this)}i.prototype={refresh:function(){!function(){var e=this[" entryWrapper"].childNodes;for(;0<e.length;)e[0].remove()}.call(this);s.call(this)}};function n(){this[" entryWrapper"].querySelectorAll(this[" entryJig"].tagName).forEach(function(e){if(void 0!==e.fight){var t=e.fight.getWhiteOpponent().getPerson().getLockOut(),i=e.fight.getRedOpponent().getPerson().getLockOut(),n=e.querySelector(this[" cssWhiteLockOut"]),e=e.querySelector(this[" cssRedLockOut"]);n&&(n.innerText=!t||t.get()<1?"-:--":o.getMinSecDisplay(t.get()));e&&(e.innerText=!i||i.get()<1?"-:--":o.getMinSecDisplay(i.get()))}}.bind(this));requestAnimationFrame(n.bind(this))}function s(){var e,t,i=this[" tournament"].getPlaylist();i.reset();for(;e=i.next();){(t=this[" entryJig"].cloneNode(!0)).fight=e;t.querySelector(this[" cssWhiteName"]).innerText=e.getWhiteOpponent().getFullName();t.querySelector(this[" cssRedName"]).innerText=e.getRedOpponent().getFullName();this[" entryWrapper"].appendChild(t)}}return{create:function(e,t){return new i(e,t)}}});!function(e,t){if("function"==typeof define&&define.amd)define("direzione-lib/util/RingIterator",t);else if("object"==typeof module&&module.exports)module.exports=t();else{e.Direzione=e.Direzione||{};e.Direzione.RingIterator=t()}}(this,function(){function t(e){this[" arr"]=e;this[" values"]=e.values();this[" turn"]=1}t.prototype={next:function(){var e=this[" values"].next();if(e.done){this[" values"]=this[" arr"].values();this[" turn"]++;return this[" values"].next().value}return e.value},getTurn:function(){return this[" turn"]}};return{create:function(e){return new t(e)}}});!function(e,t){if("function"==typeof define&&define.amd)define("direzione-lib/util/RoundRobinTournamentIterator",["direzione-lib/util/RingIterator"],t);else if("object"==typeof module&&module.exports)module.exports=t(require("./RingIterator"));else{e.Direzione=e.Direzione||{};e.Direzione.RoundRobinTournamentIterator=t(e.Direzione.RingIterator)}}(this,function(t){function i(e){if(e.length<2)throw new RangeError("Provide an array with at least two elements!");e.length%2&&e.push(null);this[" startPos"]=1;this[" break"]=!1;this[" maxTurns"]=e.length;this[" half"]=Math.floor((e.length-1)/2);this[" iterator"]=t.create(e);this[" queue"]=[];this[" postQueue"]=[];this[" stack"]=[];this[" postStack"]=[]}i.prototype={next:function(){var e,t,i=this[" half"],n=this[" iterator"];if(0<this[" queue"].length)return this[" break"]=1===this[" queue"].length&&n.getTurn()<this[" maxTurns"]-1,[this[" stack"].pop(),this[" queue"].shift()];if(this[" break"])return this[" break"]=!1,[];for(var o=this[" startPos"];;o++){t=n.next();e=n.getTurn();if(this[" maxTurns"]<=e)return null;if(o===e)this[" satellite"]=t;else{if(o===this[" maxTurns"]){this[" stack"]=this[" stack"].concat(this[" postStack"]);this[" queue"]=this[" queue"].concat(this[" postQueue"]);this[" postStack"]=[];this[" postQueue"]=[];return null!==t?[t,this[" satellite"]]:(this[" break"]=1===this[" queue"].length&&n.getTurn()<this[" maxTurns"]-1,[this[" stack"].pop(),this[" queue"].shift()])}o<=e+i&&e<o?this[" queue"].push(t):e+i<o&&o<=e+2*i?this[" stack"].push(t):o<e&&e-i<=o?this[" postStack"].push(t):o<e-i&&this[" postQueue"].push(t)}}}};return{create:function(e){return new i(e)}}});!function(e,t){if("function"==typeof define&&define.amd)define("direzione-lib/model/Tournament",["direzione-lib/model/Fight","direzione-lib/model/FightHistory","direzione-lib/config/FightSettings","direzione-lib/model/Opponent","direzione-lib/model/OpponentGroup","direzione-lib/model/Person","direzione-lib/view/Scoreboard","direzione-lib/service/FightEmitter","direzione-lib/service/FightReceiver","direzione-lib/service/FightEmitterLocal","direzione-lib/service/FightReceiverLocal","direzione-lib/service/LocalBroker","direzione-lib/model/Playlist","direzione-lib/view/Repertoire","direzione-lib/util/Utils","direzione-lib/util/RingIterator","direzione-lib/util/RoundRobinTournamentIterator"],t);else if("object"==typeof module&&module.exports)module.exports=t(require("./Fight"),require("./FightHistory"),require("../config/FightSettings"),require("./Opponent"),require("./OpponentGroup"),require("./Person"),require("../view/Scoreboard"),require("../service/FightEmitter"),require("../service/FightReceiver"),require("../service/FightEmitterLocal"),require("../service/FightReceiverLocal"),require("../service/LocalBroker"),require("./Playlist"),require("../view/Repertoire"),require("../util/Utils"),require("../util/RingIterator"),require("../util/RoundRobinTournamentIterator"));else{e.Direzione=t(e.Direzione.Fight,e.Direzione.FightHistory,e.Direzione.FightSettings,e.Direzione.Opponent,e.Direzione.OpponentGroup,e.Direzione.Person,e.Direzione.Scoreboard,e.Direzione.FightEmitter,e.Direzione.FightReceiver,e.Direzione.FightEmitterLocal,e.Direzione.FightReceiverLocal,e.Direzione.LocalBroker,e.Direzione.Playlist,e.Direzione.Repertoire,e.Direzione.Utils,e.Direzione.RingIterator,e.Direzione.RoundRobinTournamentIterator);e.Direzione.Tournament={create:e.Direzione.create}}}(this,function(i,e,t,n,o,s,r,h,u,c,l,a,d,f,p,g,m){function v(e){this[" groups"]=[];this[" playlist"]=d.create();this[" fightSettings"]=e}v.prototype={addGroup:function(e){this[" groups"].push(e);return this},setGroups:function(e){this[" groups"]=e;return this},build:function(t){var e,i,n,o=0,s=[];this[" iterators"]=[];"create"in t||new TypeError("Not an iterator!");this[" groups"].forEach(function(e){this[" iterators"].push(t.create(e.getPersons()));s.push(!1)},this);e=g.create(this[" iterators"]);for(;i=e.next();){for(;;){if(null===(n=i.next())){s[o%this[" iterators"].length]=!0;break}if(0===n.length)break;w.call(this,n[0],n[1])}if(s.every(function(e){return e}))return;o++}},getPlaylist:function(){return this[" playlist"]}};function b(){var e=new Audio(this[" fightSettings"].getTimeUpSoundFile());e.currentTime=0;e.oncanplay=function(){e.play()}}function w(e,t){e=i.create(this[" fightSettings"],n.create(e),n.create(t));this[" playlist"].insert(e.on("timeUp",b.bind(this)));return e}return{Fight:i,FightHistory:e,FightSettings:t,Opponent:n,OpponentGroup:o,Person:s,Scoreboard:r,FightEmitter:h,FightReceiver:u,FightEmitterLocal:c,FightReceiverLocal:l,LocalBroker:a,Playlist:d,Repertoire:f,Utils:p,RingIterator:g,RoundRobinTournamentIterator:m,create:function(e){return new v(e)}}});"function"==typeof define&&define.amd&&define(["direzione-lib/model/Tournament"],function(e){return e});